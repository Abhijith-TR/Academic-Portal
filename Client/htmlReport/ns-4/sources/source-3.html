


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > Student</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.example.users</a>
</div>

<h1>Coverage Summary for Class: Student (org.example.users)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">Student</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    53.3%
  </span>
  <span class="absValue">
    (8/15)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    54.5%
  </span>
  <span class="absValue">
    (78/143)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.example.users;
&nbsp;
&nbsp;import org.example.daoInterfaces.StudentDAO;
&nbsp;import org.example.utils.Utils;
&nbsp;
&nbsp;import java.sql.SQLOutput;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.HashMap;
&nbsp;
&nbsp;public class Student extends User {
&nbsp;    final private StudentDAO studentDAO;
&nbsp;
&nbsp;    public Student( String id, StudentDAO studentDAO ) {
<b class="fc">&nbsp;        super( id, studentDAO );</b>
<b class="fc">&nbsp;        this.studentDAO = studentDAO;</b>
&nbsp;    }
&nbsp;
&nbsp;    // The default cutoff of 4 is implemented here.
&nbsp;    private boolean checkCourseCatalogPrerequisites( String courseCode ) {
<b class="fc">&nbsp;        String[] prerequisites = studentDAO.getCourseCatalogPrerequisites( courseCode );</b>
<b class="fc">&nbsp;        if ( prerequisites == null ) return false;</b>
&nbsp;
<b class="fc">&nbsp;        for ( String course : prerequisites ) {</b>
<b class="fc">&nbsp;            boolean hasPassed = studentDAO.checkStudentPassStatus( course, 4, id );</b>
<b class="fc">&nbsp;            if ( !hasPassed ) {</b>
<b class="fc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    // A database error and no prerequisites will both return null. But student should not be allowed to enroll if there is a database error
&nbsp;    private boolean checkInstructorPrerequisites( String courseCode, int[] currentSession, String courseDepartment ) {
<b class="fc">&nbsp;        int        currentYear     = currentSession[0];</b>
<b class="fc">&nbsp;        int        currentSemester = currentSession[1];</b>
<b class="fc">&nbsp;        String[][] prerequisites   = studentDAO.getInstructorPrerequisites( courseCode, currentYear, currentSemester, courseDepartment );</b>
<b class="fc">&nbsp;        if ( prerequisites == null ) return false;</b>
&nbsp;
<b class="fc">&nbsp;        for ( String[] listOfCourses : prerequisites ) {</b>
<b class="fc">&nbsp;            boolean isEligible = false;</b>
<b class="fc">&nbsp;            for ( int i = 0; i &lt; listOfCourses.length; i += 2 ) {</b>
<b class="fc">&nbsp;                String course = listOfCourses[i];</b>
&nbsp;                // PostgreSQL allows only matrices i.e., jagged arrays are not allowed. So some arrays might have additional useless entries.
<b class="fc">&nbsp;                if ( course.length() == 0 ) break;</b>
<b class="fc">&nbsp;                int gradeCutoff = Utils.getGradeValue( listOfCourses[i + 1] );</b>
<b class="fc">&nbsp;                isEligible |= studentDAO.checkStudentPassStatus( course, gradeCutoff, id );</b>
&nbsp;            }
<b class="fc">&nbsp;            if ( !isEligible ) return false;</b>
&nbsp;        }
<b class="fc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean checkStudentEligibility( String courseCode, int[] currentSession, String courseDepartment ) {
<b class="fc">&nbsp;        boolean hasCompletedCourseCatalogPrerequisites = checkCourseCatalogPrerequisites( courseCode );</b>
<b class="fc">&nbsp;        if ( !hasCompletedCourseCatalogPrerequisites ) {</b>
<b class="fc">&nbsp;            return false;</b>
&nbsp;        }
<b class="fc">&nbsp;        return checkInstructorPrerequisites( courseCode, currentSession, courseDepartment );</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean checkCreditLimit( String courseCode, int[] currentSession ) {
<b class="fc">&nbsp;        int currentYear     = currentSession[0];</b>
<b class="fc">&nbsp;        int currentSemester = currentSession[1];</b>
&nbsp;
&nbsp;        // We might want to store this in the database if necessary
<b class="fc">&nbsp;        double minimumCreditLimit = 18;</b>
<b class="fc">&nbsp;        double maximumCreditLimit = 24;</b>
&nbsp;
<b class="fc">&nbsp;        double creditsInCurrentSemester = studentDAO.getCreditsInSession( id, currentYear, currentSemester );</b>
&nbsp;        double creditsInPreviousSemester, creditsInSemesterBefore;
&nbsp;
<b class="fc">&nbsp;        if ( currentSemester == 2 ) {</b>
<b class="fc">&nbsp;            creditsInPreviousSemester = studentDAO.getCreditsInSession( id, currentYear, currentSemester - 1 );</b>
<b class="fc">&nbsp;            creditsInSemesterBefore = studentDAO.getCreditsInSession( id, currentYear - 1, 2 );</b>
&nbsp;        }
&nbsp;        else {
<b class="nc">&nbsp;            creditsInPreviousSemester = studentDAO.getCreditsInSession( id, currentYear - 1, 2 );</b>
<b class="nc">&nbsp;            creditsInSemesterBefore = studentDAO.getCreditsInSession( id, currentYear - 1, 1 );</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        double creditLimit = ( creditsInSemesterBefore + creditsInPreviousSemester ) / 2 * 1.25;</b>
<b class="fc">&nbsp;        creditLimit = Math.max( creditLimit, minimumCreditLimit );</b>
<b class="fc">&nbsp;        creditLimit = Math.min( creditLimit, maximumCreditLimit );</b>
&nbsp;
<b class="fc">&nbsp;        double creditsOfCourse = studentDAO.getCreditsOfCourse( courseCode );</b>
&nbsp;
<b class="fc">&nbsp;        return ( creditsInCurrentSemester + creditsOfCourse ) &gt; creditLimit;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean enroll( String courseCode, String courseDepartment ) {
&nbsp;        // Gets the current year and semester
<b class="fc">&nbsp;        int[] currentSession  = studentDAO.getCurrentAcademicSession();</b>
<b class="fc">&nbsp;        int   currentYear     = currentSession[0];</b>
<b class="fc">&nbsp;        int   currentSemester = currentSession[1];</b>
&nbsp;
&nbsp;        // Check if it is currently the enrolling event
<b class="fc">&nbsp;        if ( !studentDAO.isCurrentEventEnrolling( currentYear, currentSemester ) ) return false;</b>
&nbsp;
&nbsp;        // Checks whether this particular course has been offered in the current session by the mentioned department
<b class="fc">&nbsp;        boolean doesCourseExist = studentDAO.checkCourseOffering( courseCode, currentYear, currentSemester, courseDepartment );</b>
<b class="fc">&nbsp;        if ( !doesCourseExist ) return false;</b>
&nbsp;
&nbsp;        // Checks whether the student has got any grade in this course before
<b class="fc">&nbsp;        String courseGrade = studentDAO.getCourseGrade( this.id, courseCode );</b>
<b class="fc">&nbsp;        if ( Utils.getGradeValue( courseGrade ) &gt;= 4 ) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Checks whether the student has completed all the prerequisites i.e., instructor prerequisites and course catalog prerequisites
<b class="fc">&nbsp;        boolean isStudentEligible = checkStudentEligibility( courseCode, currentSession, courseDepartment );</b>
<b class="fc">&nbsp;        if ( !isStudentEligible ) return false;</b>
&nbsp;
&nbsp;        // Check the CGPA criteria
<b class="fc">&nbsp;        double CGPA         = getCGPA();</b>
<b class="fc">&nbsp;        double CGPACriteria = studentDAO.getCGPACriteria( courseCode, currentYear, currentSemester, courseDepartment );</b>
<b class="fc">&nbsp;        if ( CGPA &lt; CGPACriteria) return false;</b>
&nbsp;
&nbsp;        // Checks whether enrolling in this course would exceed the credit limit
<b class="fc">&nbsp;        boolean creditLimitExceeded = checkCreditLimit( courseCode, currentSession );</b>
<b class="fc">&nbsp;        if ( creditLimitExceeded ) return false;</b>
&nbsp;
&nbsp;        // Getting the department of the student and the department of the course
<b class="fc">&nbsp;        String studentDepartment = studentDAO.getStudentDepartment( this.id );</b>
<b class="fc">&nbsp;        if ( studentDepartment == &quot;&quot; ) return false;</b>
&nbsp;
&nbsp;        // Getting the batch of the student
<b class="fc">&nbsp;        int batch = studentDAO.getBatch( this.id );</b>
&nbsp;
&nbsp;        // Getting the course category. If the batch and department combination does not exist, the student is not eligible for the offering
<b class="fc">&nbsp;        String courseCategory = getCourseCategory( courseCode, currentYear, currentSemester, studentDepartment, batch, courseDepartment );</b>
<b class="fc">&nbsp;        if ( courseCategory.equals( &quot;&quot; ) ) return false;</b>
&nbsp;
<b class="fc">&nbsp;        System.out.println(courseCode);</b>
&nbsp;        // Once all of the above conditions are fulfilled, the student is eligible to enroll in the course
&nbsp;        // The request to enroll is sent to the database
<b class="fc">&nbsp;        return studentDAO.enroll( courseCode, this.id, currentYear, currentSemester, courseDepartment, courseCategory );</b>
&nbsp;    }
&nbsp;
&nbsp;    private String getCourseCategory( String courseCode, int year, int semester, String studentDepartment, int batch, String courseDepartment ) {
&nbsp;        // Contains all the categories and the corresponding departments and batches for which the course is offered
<b class="fc">&nbsp;        HashMap&lt;String, String[]&gt; offerings = studentDAO.getAllOfferings( courseCode, year, semester, courseDepartment );</b>
&nbsp;
&nbsp;        // Go through all the categories
<b class="fc">&nbsp;        for ( String category : offerings.keySet() ) {</b>
&nbsp;            // Go through all the departments and batches for which it was offered
<b class="fc">&nbsp;            String[] offeredDepartments = offerings.get( category );</b>
<b class="fc">&nbsp;            System.out.println( offeredDepartments.length );</b>
<b class="fc">&nbsp;            for ( String batchDepartment : offeredDepartments ) {</b>
<b class="fc">&nbsp;                String[] temp       = batchDepartment.split( &quot;-&quot; );</b>
<b class="fc">&nbsp;                int      batchFound = Integer.parseInt( temp[0] );</b>
<b class="fc">&nbsp;                String   department = temp[1];</b>
<b class="fc">&nbsp;                System.out.println( batchFound + &quot; &quot; + department);</b>
<b class="fc">&nbsp;                System.out.println( batch + &quot; &quot; + studentDepartment );</b>
&nbsp;                // If the department is the students department and the batch is the students batch, return the corresponding category
<b class="fc">&nbsp;                if ( batchFound == batch &amp;&amp; department.equals( studentDepartment ) ) return category;</b>
&nbsp;            }
<b class="fc">&nbsp;        }</b>
&nbsp;
&nbsp;        // If the course has not been offered for this batch, return an empty string to denote that student is not eligible
<b class="nc">&nbsp;        return &quot;&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String drop( String courseCode ) {
&nbsp;        // Get the current year and semester
<b class="nc">&nbsp;        int[] currentSession  = studentDAO.getCurrentAcademicSession();</b>
<b class="nc">&nbsp;        int   currentYear     = currentSession[0];</b>
<b class="nc">&nbsp;        int   currentSemester = currentSession[1];</b>
&nbsp;
&nbsp;        // Check if it is currently the enrolling event
<b class="nc">&nbsp;        if ( !studentDAO.isCurrentEventEnrolling( currentYear, currentSemester ) )</b>
<b class="nc">&nbsp;            return &quot;Drop is only allowed during ENROLLING event&quot;;</b>
&nbsp;
<b class="nc">&nbsp;        boolean courseDropStatus = studentDAO.dropCourse( courseCode, id, currentYear, currentSemester );</b>
<b class="nc">&nbsp;        if ( courseDropStatus ) return &quot;Enrollment Dropped Successfully&quot;;</b>
<b class="nc">&nbsp;        else return &quot;Could not find enrollment in current semester&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String[][][] getGradesForCourse() {
<b class="nc">&nbsp;        ArrayList&lt;String[][]&gt; studentCourseRecords = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="nc">&nbsp;        int[] currentSession  = studentDAO.getCurrentAcademicSession();</b>
<b class="nc">&nbsp;        int   currentYear     = currentSession[0];</b>
<b class="nc">&nbsp;        int   currentSemester = currentSession[1];</b>
<b class="nc">&nbsp;        int   studentBatch    = studentDAO.getBatch( this.id );</b>
<b class="nc">&nbsp;        for ( int year = studentBatch; year &lt;= currentYear; year++ ) {</b>
<b class="nc">&nbsp;            for ( int semester = 1; semester &lt;= 2; semester++ ) {</b>
<b class="nc">&nbsp;                studentCourseRecords.add( getGrades( year, semester ) );</b>
<b class="nc">&nbsp;                if ( year == currentYear &amp;&amp; semester == currentSemester ) break;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return studentCourseRecords.toArray( new String[studentCourseRecords.size()][][] );</b>
&nbsp;    }
&nbsp;
&nbsp;    public String[][] getGrades( int year, int semester ) {
<b class="nc">&nbsp;        String[][] semesterGrades = studentDAO.getStudentGradesForSemester( this.id, year, semester );</b>
<b class="nc">&nbsp;        return semesterGrades;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getBatch() {
<b class="nc">&nbsp;        return studentDAO.getBatch( this.id );</b>
&nbsp;    }
&nbsp;
&nbsp;    public double computeSGPA( String[][] records ) {
<b class="nc">&nbsp;        double totalCredits  = 0;</b>
<b class="nc">&nbsp;        double creditsEarned = 0;</b>
&nbsp;
<b class="nc">&nbsp;        for ( String[] record : records ) {</b>
<b class="nc">&nbsp;            double credits             = Double.parseDouble( record[3] );</b>
<b class="nc">&nbsp;            double numericalGradeValue = Utils.getGradeValue( record[2] );</b>
<b class="nc">&nbsp;            totalCredits += credits;</b>
<b class="nc">&nbsp;            creditsEarned += ( numericalGradeValue ) / 10 * credits;</b>
&nbsp;        }
<b class="nc">&nbsp;        if ( totalCredits == 0 ) return 0;</b>
<b class="nc">&nbsp;        return creditsEarned / totalCredits * 10;</b>
&nbsp;    }
&nbsp;
&nbsp;    public double getCGPA() {
<b class="fc">&nbsp;        String[][] records       = studentDAO.getAllRecords( this.id );</b>
<b class="fc">&nbsp;        double     totalCredits  = 0;</b>
<b class="fc">&nbsp;        double     creditsEarned = 0;</b>
&nbsp;
<b class="fc">&nbsp;        for ( String[] record : records ) {</b>
<b class="nc">&nbsp;            double credits             = Double.parseDouble( record[0] );</b>
<b class="nc">&nbsp;            int    numericalGradeValue = Utils.getGradeValue( record[1] );</b>
&nbsp;            // E and F grades are not considered in the computation of CGPA
<b class="nc">&nbsp;            if ( numericalGradeValue &lt; 4 ) continue;</b>
<b class="nc">&nbsp;            totalCredits += credits;</b>
<b class="nc">&nbsp;            creditsEarned += ( numericalGradeValue ) / 10.0 * credits;</b>
&nbsp;        }
<b class="fc">&nbsp;        if ( totalCredits == 0 ) return 0;</b>
<b class="nc">&nbsp;        return creditsEarned / totalCredits * 10;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String[][] getAvailableCourses() {
<b class="nc">&nbsp;        int[]      currentSession  = studentDAO.getCurrentAcademicSession();</b>
<b class="nc">&nbsp;        int        currentYear     = currentSession[0];</b>
<b class="nc">&nbsp;        int        currentSemester = currentSession[1];</b>
<b class="nc">&nbsp;        String[][] coursesOffered  = studentDAO.getOfferedCourses( currentYear, currentSemester );</b>
<b class="nc">&nbsp;        return coursesOffered;</b>
&nbsp;    }
&nbsp;
&nbsp;    public HashMap&lt;String, Double&gt; getRemainingCreditRequirements() {
&nbsp;        // Get the batch of the student and retrieve the UG curriculum of the corresponding batch
<b class="nc">&nbsp;        int                     batch        = studentDAO.getBatch( this.id );</b>
<b class="nc">&nbsp;        HashMap&lt;String, Double&gt; ugCurriculum = studentDAO.getUGCurriculum( batch );</b>
&nbsp;
&nbsp;        // Now we have to fetch the course categories and the corresponding credits done by the student
<b class="nc">&nbsp;        HashMap&lt;String, Double&gt; categoryCreditsCompleted = studentDAO.getCreditsInAllCategories( this.id );</b>
<b class="nc">&nbsp;        HashMap&lt;String, Double&gt; categoryCreditsLeft      = new HashMap&lt;&gt;();</b>
&nbsp;
&nbsp;        // Additional credits in any category will count towards the open electives section
<b class="nc">&nbsp;        double additionalCredits = 0;</b>
<b class="nc">&nbsp;        for ( String category : ugCurriculum.keySet() ) {</b>
<b class="nc">&nbsp;            if ( categoryCreditsCompleted.containsKey( category ) ) {</b>
<b class="nc">&nbsp;                double creditsNeeded    = ugCurriculum.get( category );</b>
<b class="nc">&nbsp;                double creditsCompleted = categoryCreditsCompleted.get( category );</b>
&nbsp;
&nbsp;                // If student has done fewer credits than necessary, return false
<b class="nc">&nbsp;                if ( creditsNeeded &gt; creditsCompleted ) {</b>
<b class="nc">&nbsp;                    categoryCreditsLeft.put( category, creditsNeeded - creditsCompleted );</b>
&nbsp;                }
&nbsp;                // If student has done more credits than necessary, those can be used for open electives
&nbsp;                else {
<b class="nc">&nbsp;                    categoryCreditsLeft.put( category, 0.0 );</b>
<b class="nc">&nbsp;                    additionalCredits += creditsCompleted - creditsNeeded;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;            else {
<b class="nc">&nbsp;                categoryCreditsLeft.put( category, ugCurriculum.get( category ) );</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
&nbsp;        // Now we have to get open elective requirements to 0 if required
<b class="nc">&nbsp;        if ( categoryCreditsLeft.containsKey( &quot;OE&quot; ) ) {</b>
<b class="nc">&nbsp;            double creditsLeft = categoryCreditsLeft.get( &quot;OE&quot; );</b>
<b class="nc">&nbsp;            categoryCreditsLeft.put( &quot;OE&quot;, Math.max( creditsLeft - additionalCredits, 0.0 ) );</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return categoryCreditsLeft;</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-02-18 19:12</div>
</div>
</body>
</html>
