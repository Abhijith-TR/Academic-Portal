


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > Student</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.abhijith.users</a>
</div>

<h1>Coverage Summary for Class: Student (org.abhijith.users)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">Student</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    93.3%
  </span>
  <span class="absValue">
    (14/15)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    96.6%
  </span>
  <span class="absValue">
    (142/147)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.abhijith.users;
&nbsp;
&nbsp;import org.abhijith.dal.PostgresStudentDAO;
&nbsp;import org.abhijith.daoInterfaces.StudentDAO;
&nbsp;import org.abhijith.utils.Utils;
&nbsp;
&nbsp;import java.io.FileInputStream;
&nbsp;import java.io.InputStream;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.Properties;
&nbsp;
&nbsp;public class Student extends User {
&nbsp;    private StudentDAO studentDAO;
&nbsp;
&nbsp;    public Student( String id ) {
<b class="fc">&nbsp;        super( id );</b>
&nbsp;        try {
<b class="fc">&nbsp;            Properties databaseConfig = new Properties();</b>
<b class="fc">&nbsp;            ClassLoader classLoader = Student.class.getClassLoader();</b>
<b class="fc">&nbsp;            InputStream inputStream = classLoader.getResourceAsStream( &quot;config.properties&quot; );</b>
<b class="fc">&nbsp;            databaseConfig.load( inputStream );</b>
&nbsp;
<b class="fc">&nbsp;            String connectionURL = databaseConfig.getProperty( &quot;student.connectionURL&quot; );</b>
<b class="fc">&nbsp;            String username      = databaseConfig.getProperty( &quot;student.username&quot; );</b>
<b class="fc">&nbsp;            String password      = databaseConfig.getProperty( &quot;student.password&quot; );</b>
<b class="fc">&nbsp;            this.studentDAO = new PostgresStudentDAO(</b>
&nbsp;                    connectionURL,
&nbsp;                    username,
&nbsp;                    password
&nbsp;            );
<b class="fc">&nbsp;            super.setCommonDAO( studentDAO );</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Could not connect to database&quot; );</b>
<b class="fc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setStudentDAO( StudentDAO studentDAO ) {
<b class="nc">&nbsp;        this.studentDAO = studentDAO;</b>
&nbsp;    }
&nbsp;
&nbsp;    // The default cutoff of 4 is implemented here.
&nbsp;    private boolean checkCourseCatalogPrerequisites( String courseCode ) {
<b class="fc">&nbsp;        String[] prerequisites = studentDAO.getCourseCatalogPrerequisites( courseCode );</b>
<b class="fc">&nbsp;        if ( prerequisites == null ) return false;</b>
&nbsp;
<b class="fc">&nbsp;        for ( String course : prerequisites ) {</b>
<b class="fc">&nbsp;            boolean hasPassed = studentDAO.checkStudentPassStatus( course, 4, id );</b>
<b class="fc">&nbsp;            if ( !hasPassed ) {</b>
<b class="fc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    // A database error and no prerequisites will both return null. But student should not be allowed to enroll if there is a database error
&nbsp;    private boolean checkInstructorPrerequisites( String courseCode, int[] currentSession, String courseDepartment ) {
<b class="fc">&nbsp;        int        currentYear     = currentSession[0];</b>
<b class="fc">&nbsp;        int        currentSemester = currentSession[1];</b>
<b class="fc">&nbsp;        String[][] prerequisites   = studentDAO.getInstructorPrerequisites( courseCode, currentYear, currentSemester, courseDepartment );</b>
<b class="fc">&nbsp;        if ( prerequisites == null ) return false;</b>
&nbsp;
<b class="fc">&nbsp;        for ( String[] listOfCourses : prerequisites ) {</b>
<b class="fc">&nbsp;            boolean isEligible = false;</b>
<b class="fc">&nbsp;            for ( int i = 0; i &lt; listOfCourses.length; i += 2 ) {</b>
<b class="fc">&nbsp;                String course      = listOfCourses[i];</b>
<b class="fc">&nbsp;                int    gradeCutoff = Integer.parseInt( listOfCourses[i + 1] );</b>
<b class="fc">&nbsp;                isEligible |= studentDAO.checkStudentPassStatus( course, gradeCutoff, id );</b>
&nbsp;            }
<b class="fc">&nbsp;            if ( !isEligible ) return false;</b>
&nbsp;        }
<b class="fc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean checkStudentEligibility( String courseCode, int[] currentSession, String courseDepartment ) {
<b class="fc">&nbsp;        boolean hasCompletedCourseCatalogPrerequisites = checkCourseCatalogPrerequisites( courseCode );</b>
<b class="fc">&nbsp;        if ( !hasCompletedCourseCatalogPrerequisites ) {</b>
<b class="fc">&nbsp;            return false;</b>
&nbsp;        }
<b class="fc">&nbsp;        return checkInstructorPrerequisites( courseCode, currentSession, courseDepartment );</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean checkCreditLimit( String courseCode, int[] currentSession ) {
<b class="fc">&nbsp;        int currentYear     = currentSession[0];</b>
<b class="fc">&nbsp;        int currentSemester = currentSession[1];</b>
&nbsp;
&nbsp;        // We might want to store this in the database if necessary
<b class="fc">&nbsp;        double minimumCreditLimit = 18;</b>
<b class="fc">&nbsp;        double maximumCreditLimit = 24;</b>
&nbsp;
<b class="fc">&nbsp;        double creditsInCurrentSemester = studentDAO.getCreditsInSession( id, currentYear, currentSemester );</b>
&nbsp;        double creditsInPreviousSemester, creditsInSemesterBefore;
&nbsp;
<b class="fc">&nbsp;        if ( currentSemester == 2 ) {</b>
<b class="fc">&nbsp;            creditsInPreviousSemester = studentDAO.getCreditsInSession( id, currentYear, currentSemester - 1 );</b>
<b class="fc">&nbsp;            creditsInSemesterBefore = studentDAO.getCreditsInSession( id, currentYear - 1, 2 );</b>
&nbsp;        }
&nbsp;        else {
<b class="nc">&nbsp;            creditsInPreviousSemester = studentDAO.getCreditsInSession( id, currentYear - 1, 2 );</b>
<b class="nc">&nbsp;            creditsInSemesterBefore = studentDAO.getCreditsInSession( id, currentYear - 1, 1 );</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        double creditLimit = ( creditsInSemesterBefore + creditsInPreviousSemester ) / 2 * 1.25;</b>
<b class="fc">&nbsp;        creditLimit = Math.max( creditLimit, minimumCreditLimit );</b>
<b class="fc">&nbsp;        creditLimit = Math.min( creditLimit, maximumCreditLimit );</b>
&nbsp;
<b class="fc">&nbsp;        double creditsOfCourse = studentDAO.getCreditsOfCourse( courseCode );</b>
&nbsp;
<b class="fc">&nbsp;        return ( creditsInCurrentSemester + creditsOfCourse ) &gt; creditLimit;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean enroll( String courseCode, String courseDepartment ) {
<b class="fc">&nbsp;        if ( courseCode == null || courseDepartment == null ) return false;</b>
&nbsp;
&nbsp;        // Gets the current year and semester
<b class="fc">&nbsp;        int[] currentSession  = studentDAO.getCurrentAcademicSession();</b>
<b class="fc">&nbsp;        int   currentYear     = currentSession[0];</b>
<b class="fc">&nbsp;        int   currentSemester = currentSession[1];</b>
&nbsp;
&nbsp;        // Check if it is currently the enrolling event
<b class="fc">&nbsp;        if ( !studentDAO.isCurrentEventEnrolling( currentYear, currentSemester ) ) return false;</b>
&nbsp;
&nbsp;        // Checks whether this particular course has been offered in the current session by the mentioned department
<b class="fc">&nbsp;        boolean doesCourseExist = studentDAO.checkCourseOffering( courseCode, currentYear, currentSemester, courseDepartment );</b>
<b class="fc">&nbsp;        if ( !doesCourseExist ) return false;</b>
&nbsp;
&nbsp;        // Checks whether the student has got any grade in this course before
<b class="fc">&nbsp;        String courseGrade = studentDAO.getCourseGrade( this.id, courseCode );</b>
&nbsp;        // &#39;-&#39; indicates that the student is already enrolled in this course in this semester
<b class="fc">&nbsp;        if ( Utils.getGradeValue( courseGrade ) &gt;= 4 || courseGrade.equals( &quot;-&quot; ) ) {</b>
<b class="fc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Checks whether the student has completed all the prerequisites i.e., instructor prerequisites and course catalog prerequisites
<b class="fc">&nbsp;        boolean isStudentEligible = checkStudentEligibility( courseCode, currentSession, courseDepartment );</b>
<b class="fc">&nbsp;        if ( !isStudentEligible ) return false;</b>
&nbsp;
&nbsp;        // Check the CGPA criteria
<b class="fc">&nbsp;        double CGPA         = getCGPA();</b>
<b class="fc">&nbsp;        double CGPACriteria = studentDAO.getCGPACriteria( courseCode, currentYear, currentSemester, courseDepartment );</b>
<b class="fc">&nbsp;        if ( CGPA &lt; CGPACriteria ) return false;</b>
&nbsp;
&nbsp;        // Checks whether enrolling in this course would exceed the credit limit
<b class="fc">&nbsp;        boolean creditLimitExceeded = checkCreditLimit( courseCode, currentSession );</b>
<b class="fc">&nbsp;        if ( creditLimitExceeded ) return false;</b>
&nbsp;
&nbsp;        // Getting the department of the student and the department of the course
<b class="fc">&nbsp;        String studentDepartment = studentDAO.getStudentDepartment( this.id );</b>
<b class="fc">&nbsp;        if ( studentDepartment.equals( &quot;&quot; ) ) return false;</b>
&nbsp;
&nbsp;        // Getting the batch of the student
<b class="fc">&nbsp;        int batch = studentDAO.getBatch( this.id );</b>
&nbsp;
&nbsp;        // Getting the course category. If the batch and department combination does not exist, the student is not eligible for the offering
<b class="fc">&nbsp;        String courseCategory = studentDAO.getCourseCategory( courseCode, currentYear, currentSemester, courseDepartment, studentDepartment, batch );</b>
<b class="fc">&nbsp;        if ( courseCategory.equals( &quot;&quot; ) ) return false;</b>
&nbsp;
&nbsp;        // Once all of the above conditions are fulfilled, the student is eligible to enroll in the course
&nbsp;        // The request to enroll is sent to the database
<b class="fc">&nbsp;        return studentDAO.enroll( courseCode, this.id, currentYear, currentSemester, courseDepartment, courseCategory );</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean drop( String courseCode ) {
&nbsp;        // Checking input parameters
<b class="fc">&nbsp;        if ( courseCode == null ) return false;</b>
&nbsp;
&nbsp;        // Get the current year and semester
<b class="fc">&nbsp;        int[] currentSession  = studentDAO.getCurrentAcademicSession();</b>
<b class="fc">&nbsp;        int   currentYear     = currentSession[0];</b>
<b class="fc">&nbsp;        int   currentSemester = currentSession[1];</b>
&nbsp;
&nbsp;        // Check if it is currently the enrolling event
<b class="fc">&nbsp;        if ( !studentDAO.isCurrentEventEnrolling( currentYear, currentSemester ) )</b>
<b class="fc">&nbsp;            return false;</b>
&nbsp;
&nbsp;        // Returns true if the course drop was successful. False otherwise
<b class="fc">&nbsp;        return studentDAO.dropCourse( courseCode, id, currentYear, currentSemester );</b>
&nbsp;    }
&nbsp;
&nbsp;    public String[][][] getGradesForCourse() {
&nbsp;        // Array to store the records
<b class="fc">&nbsp;        ArrayList&lt;String[][]&gt; studentCourseRecords = new ArrayList&lt;&gt;();</b>
&nbsp;
&nbsp;        // Gets the current academic session. We iterate from his batch upto the current session
<b class="fc">&nbsp;        int[] currentSession  = studentDAO.getCurrentAcademicSession();</b>
<b class="fc">&nbsp;        int   currentYear     = currentSession[0];</b>
<b class="fc">&nbsp;        int   currentSemester = currentSession[1];</b>
&nbsp;
&nbsp;        // Getting the batch of the student. We start from batch - 1 as the first session
<b class="fc">&nbsp;        int studentBatch = studentDAO.getBatch( this.id );</b>
&nbsp;
&nbsp;        // We go through all years and semesters upto the current session
<b class="fc">&nbsp;        for ( int year = studentBatch; year &lt;= currentYear; year++ ) {</b>
<b class="fc">&nbsp;            for ( int semester = 1; semester &lt;= 2; semester++ ) {</b>
&nbsp;                // We use the get grades function to get the grades of a particular semester and year ( i.e., session )
<b class="fc">&nbsp;                studentCourseRecords.add( getGrades( year, semester ) );</b>
&nbsp;                // We have reached the current session, we should not be getting any more records
<b class="fc">&nbsp;                if ( year == currentYear &amp;&amp; semester == currentSemester ) break;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        // Returns the arraylist after converting it into an array
<b class="fc">&nbsp;        return studentCourseRecords.toArray( new String[studentCourseRecords.size()][][] );</b>
&nbsp;    }
&nbsp;
&nbsp;    public String[][] getGrades( int year, int semester ) {
&nbsp;        // Checking input parameters
<b class="fc">&nbsp;        if ( year &lt;= 0 || semester &lt;= 0 ) return new String[][]{};</b>
&nbsp;
<b class="fc">&nbsp;        return studentDAO.getStudentGradesForSemester( this.id, year, semester );</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getBatch() {
<b class="fc">&nbsp;        return studentDAO.getBatch( this.id );</b>
&nbsp;    }
&nbsp;
&nbsp;    public double getSGPA( String[][] records ) {
&nbsp;        // Checking input parameters
<b class="fc">&nbsp;        if ( records == null ) return 0.0;</b>
&nbsp;
<b class="fc">&nbsp;        double totalCredits  = 0;</b>
<b class="fc">&nbsp;        double creditsEarned = 0;</b>
&nbsp;
&nbsp;        // We iterate through all the records
<b class="fc">&nbsp;        for ( String[] record : records ) {</b>
&nbsp;            // Checking input parameters
<b class="fc">&nbsp;            if ( record == null || record.length != 4 ) continue;</b>
&nbsp;
&nbsp;            // We get the grades and the credits of the course
<b class="fc">&nbsp;            double credits             = Double.parseDouble( record[3] );</b>
<b class="fc">&nbsp;            double numericalGradeValue = Utils.getGradeValue( record[2] );</b>
&nbsp;
&nbsp;            // Computing the SGPA ( Note that E and F grades are considered in SGPA calculation );
<b class="fc">&nbsp;            totalCredits += credits;</b>
<b class="fc">&nbsp;            creditsEarned += ( numericalGradeValue ) / 10 * credits;</b>
&nbsp;        }
&nbsp;        // If no credits are done, return 0
<b class="fc">&nbsp;        if ( totalCredits == 0 ) return 0;</b>
&nbsp;
<b class="fc">&nbsp;        return creditsEarned / totalCredits * 10;</b>
&nbsp;    }
&nbsp;
&nbsp;    public double getCGPA() {
&nbsp;        // Get all the records of the student
<b class="fc">&nbsp;        String[][] records       = studentDAO.getAllRecords( this.id );</b>
<b class="fc">&nbsp;        double     totalCredits  = 0;</b>
<b class="fc">&nbsp;        double     creditsEarned = 0;</b>
&nbsp;
&nbsp;        // Go through every record of the student
<b class="fc">&nbsp;        for ( String[] record : records ) {</b>
&nbsp;            // If the record is not in the expected format, ignore
<b class="fc">&nbsp;            if ( record.length != 2 ) continue;</b>
<b class="fc">&nbsp;            double credits             = Double.parseDouble( record[0] );</b>
<b class="fc">&nbsp;            int    numericalGradeValue = Utils.getGradeValue( record[1] );</b>
&nbsp;
&nbsp;            // E and F grades are not considered in the computation of CGPA
<b class="fc">&nbsp;            if ( numericalGradeValue &lt; 4 ) continue;</b>
<b class="fc">&nbsp;            totalCredits += credits;</b>
<b class="fc">&nbsp;            creditsEarned += ( numericalGradeValue ) / 10.0 * credits;</b>
&nbsp;        }
&nbsp;
&nbsp;        // If the student has not done any courses, return 0
<b class="fc">&nbsp;        if ( totalCredits == 0 ) return 0;</b>
<b class="fc">&nbsp;        return creditsEarned / totalCredits * 10;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String[][] getAvailableCourses() {
&nbsp;        // Getting the current year and semester
<b class="fc">&nbsp;        int[]  currentSession    = studentDAO.getCurrentAcademicSession();</b>
<b class="fc">&nbsp;        int    currentYear       = currentSession[0];</b>
<b class="fc">&nbsp;        int    currentSemester   = currentSession[1];</b>
<b class="fc">&nbsp;        String studentDepartment = studentDAO.getStudentDepartment( this.id );</b>
<b class="fc">&nbsp;        int studentBatch = studentDAO.getBatch( this.id );</b>
&nbsp;
&nbsp;        // Getting the courses that were offered in the current session
<b class="fc">&nbsp;        String[][] coursesOffered = studentDAO.getOfferedCourses( currentYear, currentSemester );</b>
<b class="fc">&nbsp;        for ( String[] course : coursesOffered ) {</b>
<b class="fc">&nbsp;            course[course.length - 1] = studentDAO.getCourseCategory( course[0], currentYear, currentSemester, course[4], studentDepartment, studentBatch );</b>
&nbsp;        }
<b class="fc">&nbsp;        return coursesOffered;</b>
&nbsp;    }
&nbsp;
&nbsp;    public HashMap&lt;String, Double&gt; getRemainingCreditRequirements() {
&nbsp;        // Get the batch of the student and retrieve the UG curriculum of the corresponding batch
<b class="fc">&nbsp;        int                     batch        = studentDAO.getBatch( this.id );</b>
<b class="fc">&nbsp;        HashMap&lt;String, Double&gt; ugCurriculum = studentDAO.getUGCurriculum( batch );</b>
&nbsp;
&nbsp;        // Now we have to fetch the course categories and the corresponding credits done by the student
<b class="fc">&nbsp;        HashMap&lt;String, Double&gt; categoryCreditsCompleted = studentDAO.getCreditsInAllCategories( this.id );</b>
<b class="fc">&nbsp;        HashMap&lt;String, Double&gt; categoryCreditsLeft      = new HashMap&lt;&gt;();</b>
&nbsp;
&nbsp;        // Additional credits in any category will count towards the open electives section
<b class="fc">&nbsp;        double additionalCredits = 0;</b>
<b class="fc">&nbsp;        for ( String category : ugCurriculum.keySet() ) {</b>
<b class="fc">&nbsp;            if ( categoryCreditsCompleted.containsKey( category ) ) {</b>
<b class="fc">&nbsp;                double creditsNeeded    = ugCurriculum.get( category );</b>
<b class="fc">&nbsp;                double creditsCompleted = categoryCreditsCompleted.get( category );</b>
&nbsp;
&nbsp;                // If student has done fewer credits than necessary, return false
<b class="fc">&nbsp;                if ( creditsNeeded &gt; creditsCompleted ) {</b>
<b class="fc">&nbsp;                    categoryCreditsLeft.put( category, creditsNeeded - creditsCompleted );</b>
&nbsp;                }
&nbsp;                // If student has done more credits than necessary, those can be used for open electives
&nbsp;                else {
<b class="fc">&nbsp;                    categoryCreditsLeft.put( category, 0.0 );</b>
<b class="fc">&nbsp;                    additionalCredits += creditsCompleted - creditsNeeded;</b>
&nbsp;                }
<b class="fc">&nbsp;            }</b>
&nbsp;            else {
<b class="fc">&nbsp;                categoryCreditsLeft.put( category, ugCurriculum.get( category ) );</b>
&nbsp;            }
<b class="fc">&nbsp;        }</b>
&nbsp;
&nbsp;        // Now we have to get open elective requirements to 0 if required
<b class="fc">&nbsp;        if ( categoryCreditsLeft.containsKey( &quot;OE&quot; ) ) {</b>
<b class="fc">&nbsp;            double creditsLeft = categoryCreditsLeft.get( &quot;OE&quot; );</b>
<b class="fc">&nbsp;            categoryCreditsLeft.put( &quot;OE&quot;, Math.max( creditsLeft - additionalCredits, 0.0 ) );</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        return categoryCreditsLeft;</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-02-21 11:47</div>
</div>
</body>
</html>
