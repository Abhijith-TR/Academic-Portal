


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > PostgresCommonDAO</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.example.dal</a>
</div>

<h1>Coverage Summary for Class: PostgresCommonDAO (org.example.dal)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">PostgresCommonDAO</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    35.7%
  </span>
  <span class="absValue">
    (5/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    20.1%
  </span>
  <span class="absValue">
    (28/139)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.example.dal;
&nbsp;
&nbsp;import org.example.daoInterfaces.CommonDAO;
&nbsp;import org.example.utils.Utils;
&nbsp;
&nbsp;import javax.xml.transform.Result;
&nbsp;import java.sql.*;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.HashMap;
&nbsp;
&nbsp;public class PostgresCommonDAO implements CommonDAO {
&nbsp;    protected Connection databaseConnection;
&nbsp;
<b class="fc">&nbsp;    public PostgresCommonDAO( String connectionURL, String username, String password ) {</b>
&nbsp;        try {
<b class="fc">&nbsp;            databaseConnection = DriverManager.getConnection(</b>
&nbsp;                    connectionURL,
&nbsp;                    username,
&nbsp;                    password
&nbsp;            );
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database error. Please try again later&quot; );</b>
<b class="nc">&nbsp;            System.exit( 0 );</b>
<b class="fc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    // Returns the current year and semester if successful
&nbsp;    // Otherwise returns default year and session i.e., 2020-1
&nbsp;    public int[] getCurrentAcademicSession() {
&nbsp;        try {
<b class="fc">&nbsp;            PreparedStatement getSessionQuery = databaseConnection.prepareStatement( &quot;SELECT * FROM current_year_and_semester ORDER BY year DESC, semester DESC LIMIT 1&quot; );</b>
<b class="fc">&nbsp;            ResultSet         currentSession  = getSessionQuery.executeQuery();</b>
&nbsp;
<b class="fc">&nbsp;            currentSession.next();</b>
<b class="fc">&nbsp;            int currentYear     = currentSession.getInt( 1 );</b>
<b class="fc">&nbsp;            int currentSemester = currentSession.getInt( 2 );</b>
&nbsp;
<b class="fc">&nbsp;            return new int[]{ currentYear, currentSemester };</b>
<b class="nc">&nbsp;        } catch ( SQLException error ) {</b>
<b class="nc">&nbsp;            System.out.println( error.getMessage() );</b>
<b class="nc">&nbsp;            return new int[]{ 2020, 1 };</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public String[][] getStudentGradesForSemester( String entryNumber, int year, int semester ) {
&nbsp;        try {
<b class="nc">&nbsp;            PreparedStatement gradeQuery = databaseConnection.prepareStatement( &quot;SELECT course_code, course_title, grade, credits FROM student_course_registration NATURAL JOIN course_catalog WHERE entry_number = ? AND year = ? AND semester = ?&quot; );</b>
&nbsp;
<b class="nc">&nbsp;            gradeQuery.setString( 1, entryNumber );</b>
<b class="nc">&nbsp;            gradeQuery.setInt( 2, year );</b>
<b class="nc">&nbsp;            gradeQuery.setInt( 3, semester );</b>
<b class="nc">&nbsp;            ResultSet gradeQueryResult = gradeQuery.executeQuery();</b>
&nbsp;
<b class="nc">&nbsp;            ArrayList&lt;String[]&gt; records = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            while ( gradeQueryResult.next() ) {</b>
<b class="nc">&nbsp;                String courseCode  = gradeQueryResult.getString( 1 );</b>
<b class="nc">&nbsp;                String courseTitle = gradeQueryResult.getString( 2 );</b>
<b class="nc">&nbsp;                String grade       = gradeQueryResult.getString( 3 );</b>
<b class="nc">&nbsp;                String credits     = gradeQueryResult.getString( 4 );</b>
<b class="nc">&nbsp;                records.add( new String[]{ courseCode, courseTitle, grade, credits } );</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            return records.toArray( new String[records.size()][] );</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Try again later&quot; );</b>
<b class="nc">&nbsp;            return new String[][]{};</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int getBatch( String entryNumber ) {
&nbsp;        try {
<b class="fc">&nbsp;            PreparedStatement batchQuery = databaseConnection.prepareStatement( &quot;SELECT batch FROM student WHERE entry_number = ?&quot; );</b>
<b class="fc">&nbsp;            batchQuery.setString( 1, entryNumber );</b>
<b class="fc">&nbsp;            ResultSet batchQueryResult = batchQuery.executeQuery();</b>
<b class="fc">&nbsp;            batchQueryResult.next();</b>
<b class="fc">&nbsp;            int batch = batchQueryResult.getInt( 1 );</b>
<b class="fc">&nbsp;            return batch;</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Try again later&quot; );</b>
<b class="nc">&nbsp;            return -1;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean checkCourseCatalog( String courseCode ) {
&nbsp;        try {
<b class="nc">&nbsp;            PreparedStatement checkCourseCatalogQuery = databaseConnection.prepareStatement( &quot;SELECT course_code FROM course_catalog WHERE course_code = ?&quot; );</b>
<b class="nc">&nbsp;            checkCourseCatalogQuery.setString( 1, courseCode );</b>
<b class="nc">&nbsp;            ResultSet checkCourseCatalogQueryResult = checkCourseCatalogQuery.executeQuery();</b>
<b class="nc">&nbsp;            return checkCourseCatalogQueryResult.next();</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Try again later&quot; );</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String getCurrentEvent() {
&nbsp;        try {
<b class="nc">&nbsp;            return &quot;&quot;;</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Please try again later&quot; );</b>
<b class="nc">&nbsp;            return &quot;NONE&quot;;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public HashMap&lt;String, Double&gt; getUGCurriculum( int batch ) {
&nbsp;        try {
&nbsp;            // Execute the SQL statement that will fetch the corresponding columns from the UG curriculum table
<b class="nc">&nbsp;            PreparedStatement getCurriculumQuery = databaseConnection.prepareStatement( &quot;SELECT sc, se, gr, pc, pe, hc, he, cp, ii, nn, oe FROM ug_curriculum WHERE year = ?&quot; );</b>
<b class="nc">&nbsp;            getCurriculumQuery.setInt( 1, batch );</b>
<b class="nc">&nbsp;            ResultSet getCurriculumQueryResult = getCurriculumQuery.executeQuery();</b>
<b class="nc">&nbsp;            getCurriculumQueryResult.next();</b>
&nbsp;
&nbsp;            // Now insert the categories into the hashmap along with the corresponding credit requirements
<b class="nc">&nbsp;            String[]                categories         = new String[]{ &quot;SC&quot;, &quot;SE&quot;, &quot;GR&quot;, &quot;PC&quot;, &quot;PE&quot;, &quot;HC&quot;, &quot;HE&quot;, &quot;CP&quot;, &quot;II&quot;, &quot;NN&quot;, &quot;OE&quot; };</b>
<b class="nc">&nbsp;            HashMap&lt;String, Double&gt; creditRequirements = new HashMap&lt;&gt;();</b>
&nbsp;
&nbsp;            // Just read the values from the returned set of columns and insert them into the hashmap
<b class="nc">&nbsp;            for ( int i = 0; i &lt; categories.length; i++ ) {</b>
<b class="nc">&nbsp;                Double categoryRequirement = getCurriculumQueryResult.getDouble( i + 1 );</b>
<b class="nc">&nbsp;                creditRequirements.put( categories[i], categoryRequirement );</b>
&nbsp;            }
<b class="nc">&nbsp;            return creditRequirements;</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Please try again later&quot; );</b>
<b class="nc">&nbsp;            return new HashMap&lt;&gt;();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public HashMap&lt;String, Double&gt; getCreditsInAllCategories( String entryNumber ) {
&nbsp;        try {
&nbsp;            // SQL query to get the categories and the corresponding credits completed in all of them
&nbsp;            // Note that the SQL query contains the grades that will allow the course to be marked as passed
<b class="nc">&nbsp;            PreparedStatement getCreditsQuery = databaseConnection.prepareStatement( &quot;SELECT category, sum(credits) FROM student_course_registration NATURAL JOIN course_catalog WHERE entry_number = ? AND grade IN (&#39;A&#39;, &#39;A-&#39;, &#39;B&#39;, &#39;B-&#39;, &#39;C&#39;, &#39;C-&#39;, &#39;D&#39;) GROUP BY category&quot; );</b>
<b class="nc">&nbsp;            getCreditsQuery.setString( 1, entryNumber );</b>
<b class="nc">&nbsp;            ResultSet getCreditsQueryResult = getCreditsQuery.executeQuery();</b>
&nbsp;
&nbsp;            // Now you just have to insert all the records that were returned into the hashmap and return it
<b class="nc">&nbsp;            HashMap&lt;String, Double&gt; categoryCredits = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;            while ( getCreditsQueryResult.next() ) {</b>
<b class="nc">&nbsp;                String category        = getCreditsQueryResult.getString( 1 );</b>
<b class="nc">&nbsp;                Double creditsObtained = getCreditsQueryResult.getDouble( 2 );</b>
<b class="nc">&nbsp;                categoryCredits.put( category, creditsObtained );</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            return categoryCredits;</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( error.getMessage() );</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Please try again later &quot; );</b>
<b class="nc">&nbsp;            return new HashMap&lt;&gt;();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean setPhoneNumber( String id, String phoneNumber ) {
&nbsp;        try {
&nbsp;            // SQL query to update this particular id with the phone number that is provided
<b class="nc">&nbsp;            PreparedStatement setPhoneNumberQuery = databaseConnection.prepareStatement( &quot;UPDATE common_user_details SET phone = ? WHERE id = ?&quot; );</b>
<b class="nc">&nbsp;            setPhoneNumberQuery.setString( 1, phoneNumber );</b>
<b class="nc">&nbsp;            setPhoneNumberQuery.setString( 2, id );</b>
<b class="nc">&nbsp;            setPhoneNumberQuery.executeUpdate();</b>
&nbsp;
&nbsp;            // If the query was successfully executed return true ( the only case where the update would affect 0 rows would be when the same phone number is there in the database, which is fine )
<b class="nc">&nbsp;            return true;</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Please try again later&quot; );</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean setEmail( String id, String email ) {
&nbsp;        try {
&nbsp;            // Create an SQL query to set the email of the specified user
<b class="nc">&nbsp;            PreparedStatement setEmailQuery = databaseConnection.prepareStatement( &quot;UPDATE common_user_details SET email = ? WHERE id = ?&quot; );</b>
<b class="nc">&nbsp;            setEmailQuery.setString( 1, email );</b>
<b class="nc">&nbsp;            setEmailQuery.setString( 2, id );</b>
<b class="nc">&nbsp;            setEmailQuery.executeUpdate();</b>
&nbsp;
&nbsp;            // If the query is successful, return true
<b class="nc">&nbsp;            return true;</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database error. Please try again later&quot; );</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String[] getContactDetails( String userID ) {
&nbsp;        try {
&nbsp;            // SQL query to fetch the contact details of the specified ID from the database
<b class="nc">&nbsp;            PreparedStatement getContactDetailsQuery = databaseConnection.prepareStatement( &quot;SELECT email, phone FROM common_user_details WHERE id = ?&quot; );</b>
<b class="nc">&nbsp;            getContactDetailsQuery.setString( 1, userID );</b>
<b class="nc">&nbsp;            ResultSet getContactDetailsQueryResult = getContactDetailsQuery.executeQuery();</b>
&nbsp;
&nbsp;            // Check if the user ID is actually valid and any records were returned
<b class="nc">&nbsp;            boolean isIDValid = getContactDetailsQueryResult.next();</b>
<b class="nc">&nbsp;            if ( isIDValid == false ) return new String[]{};</b>
&nbsp;
&nbsp;            // If the user id that was entered is valid, get the email and phone number and return it
<b class="nc">&nbsp;            String  email     = getContactDetailsQueryResult.getString( 1 );</b>
<b class="nc">&nbsp;            String  phone     = getContactDetailsQueryResult.getString( 2 );</b>
<b class="nc">&nbsp;            return new String[]{ email, phone };</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Please try again later&quot; );</b>
<b class="nc">&nbsp;            return new String[]{};</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean setPassword( String id, String password ) {
&nbsp;        try {
&nbsp;            // SQL statement to update the password in the database
<b class="nc">&nbsp;            PreparedStatement setPasswordQuery = databaseConnection.prepareStatement(&quot;UPDATE common_user_details SET password = ? WHERE id = ?&quot;);</b>
<b class="nc">&nbsp;            setPasswordQuery.setString( 1, password );</b>
<b class="nc">&nbsp;            setPasswordQuery.setString( 2, id );</b>
<b class="nc">&nbsp;            setPasswordQuery.executeUpdate();</b>
&nbsp;
&nbsp;            // If the query executes successfully, simply return true
<b class="nc">&nbsp;            return true;</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Please try again later&quot; );</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String getCourseGrade( String entryNumber, String courseCode ) {
&nbsp;        try {
&nbsp;            // Setting up the SQL statement
<b class="fc">&nbsp;            PreparedStatement getGradeQuery = databaseConnection.prepareStatement( &quot;SELECT grade FROM student_course_registration WHERE entry_number = ? AND course_code = ?&quot; );</b>
<b class="fc">&nbsp;            getGradeQuery.setString( 1, entryNumber );</b>
<b class="fc">&nbsp;            getGradeQuery.setString( 2, courseCode );</b>
<b class="fc">&nbsp;            ResultSet getGradeQueryResult = getGradeQuery.executeQuery();</b>
&nbsp;
&nbsp;            // If the student has done the course before, he may have done it multiple times. Get the highest possible grade
&nbsp;            // In the worst case, the student has not done the course before and his grade is &quot;-&quot; which is the not applicable symbol
<b class="fc">&nbsp;            String maximumGrade      = &quot;-&quot;;</b>
<b class="fc">&nbsp;            int    maximumGradeValue = 0;</b>
<b class="fc">&nbsp;            while ( getGradeQueryResult.next() ) {</b>
&nbsp;                // Convert the grade to a number to determine what the highest grade was
<b class="nc">&nbsp;                String grade = getGradeQueryResult.getString( 1 );</b>
<b class="nc">&nbsp;                if ( Utils.getGradeValue( grade ) &gt; maximumGradeValue ) {</b>
<b class="nc">&nbsp;                    maximumGrade = grade;</b>
<b class="nc">&nbsp;                    maximumGradeValue = Utils.getGradeValue( grade );</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;            // Return the maximum grade that was found
<b class="fc">&nbsp;            return maximumGrade;</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Please try again later&quot; );</b>
&nbsp;            // Returning an A will prevent the student from enrolling in the course
<b class="nc">&nbsp;            return &quot;A&quot;;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String getStudentDepartment( String entryNumber ) {
&nbsp;        try {
<b class="fc">&nbsp;            PreparedStatement studentBranchQuery = databaseConnection.prepareStatement( &quot;SELECT department_id FROM student WHERE entry_number = ?&quot; );</b>
<b class="fc">&nbsp;            studentBranchQuery.setString( 1, entryNumber );</b>
<b class="fc">&nbsp;            ResultSet studentBranchQueryResult = studentBranchQuery.executeQuery();</b>
<b class="fc">&nbsp;            studentBranchQueryResult.next();</b>
<b class="fc">&nbsp;            return studentBranchQueryResult.getString( 1 );</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( error.getMessage() );</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Please try again later&quot; );</b>
<b class="nc">&nbsp;            return &quot;&quot;;</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-02-18 19:12</div>
</div>
</body>
</html>
