


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > PostgresStudentDAO</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.example.dal</a>
</div>

<h1>Coverage Summary for Class: PostgresStudentDAO (org.example.dal)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">PostgresStudentDAO</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    85.7%
  </span>
  <span class="absValue">
    (12/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    56.6%
  </span>
  <span class="absValue">
    (90/159)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.example.dal;
&nbsp;
&nbsp;import org.example.daoInterfaces.StudentDAO;
&nbsp;import org.example.utils.Utils;
&nbsp;
&nbsp;import javax.xml.transform.Result;
&nbsp;import java.sql.Array;
&nbsp;import java.sql.PreparedStatement;
&nbsp;import java.sql.ResultSet;
&nbsp;import java.sql.SQLException;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.HashMap;
&nbsp;
&nbsp;public class PostgresStudentDAO extends PostgresCommonDAO implements StudentDAO {
&nbsp;    public PostgresStudentDAO( String connectionURL, String username, String password ) {
<b class="fc">&nbsp;        super( connectionURL, username, password );</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean checkCourseOffering( String courseCode, int currentYear, int currentSemester, String courseDepartment ) {
&nbsp;        try {
&nbsp;            // SQL query to find the course in the course offerings database
<b class="fc">&nbsp;            PreparedStatement checkQuery = databaseConnection.prepareStatement( &quot;SELECT course_code FROM course_offerings WHERE course_code = ? AND year = ? AND semester = ? AND department_id = ?&quot; );</b>
<b class="fc">&nbsp;            checkQuery.setString( 1, courseCode );</b>
<b class="fc">&nbsp;            checkQuery.setInt( 2, currentYear );</b>
<b class="fc">&nbsp;            checkQuery.setInt( 3, currentSemester );</b>
<b class="fc">&nbsp;            checkQuery.setString( 4, courseDepartment );</b>
<b class="fc">&nbsp;            ResultSet doesCourseExist = checkQuery.executeQuery();</b>
&nbsp;
&nbsp;            // Returns true if it manages to find such an entry
<b class="fc">&nbsp;            return doesCourseExist.next();</b>
<b class="nc">&nbsp;        } catch ( SQLException error ) {</b>
<b class="nc">&nbsp;            System.out.println( error.getMessage() );</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean checkStudentPassStatus( String courseCode, int gradeCutoff, String entryNumber ) {
&nbsp;        try {
<b class="fc">&nbsp;            PreparedStatement gradeQuery = databaseConnection.prepareStatement( &quot;SELECT grade FROM student_course_registration WHERE entry_number = ? AND course_code = ?&quot; );</b>
<b class="fc">&nbsp;            gradeQuery.setString( 1, entryNumber );</b>
<b class="fc">&nbsp;            gradeQuery.setString( 2, courseCode );</b>
<b class="fc">&nbsp;            ResultSet courseQueryResult = gradeQuery.executeQuery();</b>
<b class="fc">&nbsp;            boolean   studentCredited   = courseQueryResult.next();</b>
<b class="fc">&nbsp;            if ( !studentCredited ) {</b>
<b class="fc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            String grade = courseQueryResult.getString( 1 );</b>
<b class="nc">&nbsp;            return Utils.getGradeValue( grade ) &gt;= gradeCutoff;</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( error.getMessage() );</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String[] getCourseCatalogPrerequisites( String courseCode ) {
&nbsp;        try {
<b class="fc">&nbsp;            PreparedStatement prerequisiteQuery = databaseConnection.prepareStatement( &quot;SELECT pre_requisites FROM course_catalog WHERE course_code = ?&quot; );</b>
<b class="fc">&nbsp;            prerequisiteQuery.setString( 1, courseCode );</b>
<b class="fc">&nbsp;            ResultSet courseCatalogResult = prerequisiteQuery.executeQuery();</b>
<b class="fc">&nbsp;            boolean   subjectExists       = courseCatalogResult.next();</b>
<b class="fc">&nbsp;            if ( !subjectExists ) {</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
<b class="fc">&nbsp;            Array prerequisites = courseCatalogResult.getArray( 1 );</b>
<b class="fc">&nbsp;            if ( prerequisites == null ) return new String[]{};</b>
<b class="fc">&nbsp;            return (String[]) prerequisites.getArray();</b>
<b class="nc">&nbsp;        } catch ( SQLException error ) {</b>
<b class="nc">&nbsp;            System.out.println( error.getMessage() );</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String[][] getInstructorPrerequisites( String courseCode, int year, int semester, String courseDepartment ) {
&nbsp;        try {
<b class="fc">&nbsp;            PreparedStatement prerequisiteQuery = databaseConnection.prepareStatement( &quot;SELECT instructor_prerequisites FROM course_offerings WHERE course_code = ? AND semester = ? AND year = ? AND department_id = ?&quot; );</b>
<b class="fc">&nbsp;            prerequisiteQuery.setString( 1, courseCode );</b>
<b class="fc">&nbsp;            prerequisiteQuery.setInt( 2, semester );</b>
<b class="fc">&nbsp;            prerequisiteQuery.setInt( 3, year );</b>
<b class="fc">&nbsp;            prerequisiteQuery.setString( 4, courseDepartment );</b>
<b class="fc">&nbsp;            ResultSet prerequisiteResult = prerequisiteQuery.executeQuery();</b>
&nbsp;
<b class="fc">&nbsp;            boolean doesCourseExist = prerequisiteResult.next();</b>
<b class="fc">&nbsp;            if ( !doesCourseExist ) {</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            Array prerequisites = prerequisiteResult.getArray( 1 );</b>
<b class="fc">&nbsp;            if ( prerequisites == null ) return new String[][]{};</b>
<b class="fc">&nbsp;            return (String[][]) prerequisites.getArray();</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( error.getMessage() );</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    // The 24 is being returned to prevent you from enrolling in the course due to the exception that occurred
&nbsp;    @Override
&nbsp;    public double getCreditsOfCourse( String courseCode ) {
&nbsp;        try {
<b class="fc">&nbsp;            PreparedStatement creditQuery = databaseConnection.prepareStatement( &quot;SELECT credits FROM course_catalog WHERE course_code = ?&quot; );</b>
<b class="fc">&nbsp;            creditQuery.setString( 1, courseCode );</b>
<b class="fc">&nbsp;            ResultSet creditQueryResult  = creditQuery.executeQuery();</b>
<b class="fc">&nbsp;            boolean   querySuccessStatus = creditQueryResult.next();</b>
<b class="fc">&nbsp;            if ( !querySuccessStatus ) return 24;</b>
<b class="fc">&nbsp;            return creditQueryResult.getInt( 1 );</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( error.getMessage() );</b>
<b class="nc">&nbsp;            return 24;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    // The minimum credit limit is set to 18 and the maximum is set to 24
&nbsp;    @Override
&nbsp;    public double getCreditsInSession( String entryNumber, int currentYear, int currentSemester ) {
&nbsp;        try {
<b class="fc">&nbsp;            PreparedStatement creditQuery = databaseConnection.prepareStatement( &quot;SELECT SUM(credits) FROM course_catalog WHERE course_code IN (SELECT course_code FROM student_course_registration WHERE entry_number = ? AND year = ? AND semester = ?)&quot; );</b>
<b class="fc">&nbsp;            creditQuery.setString( 1, entryNumber );</b>
<b class="fc">&nbsp;            creditQuery.setInt( 2, currentYear );</b>
<b class="fc">&nbsp;            creditQuery.setInt( 3, currentSemester );</b>
<b class="fc">&nbsp;            ResultSet creditQueryResult = creditQuery.executeQuery();</b>
&nbsp;
<b class="fc">&nbsp;            boolean coursesFound = creditQueryResult.next();</b>
<b class="fc">&nbsp;            return ( coursesFound ) ? creditQueryResult.getInt( 1 ) : 0;</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( error.getMessage() );</b>
&nbsp;            // You should be setting the credit limit over here
<b class="nc">&nbsp;            return 24;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean enroll( String courseCode, String entryNumber, int currentYear, int currentSemester, String departmentID, String courseCategory ) {
&nbsp;        try {
<b class="fc">&nbsp;            PreparedStatement enrollmentQuery = databaseConnection.prepareStatement( &quot;INSERT INTO student_course_registration(entry_number, course_code, year, semester, department_id, category) VALUES (?, ?, ?, ?, ?, ?)&quot; );</b>
<b class="fc">&nbsp;            enrollmentQuery.setString( 1, entryNumber );</b>
<b class="fc">&nbsp;            enrollmentQuery.setString( 2, courseCode );</b>
<b class="fc">&nbsp;            enrollmentQuery.setInt( 3, currentYear );</b>
<b class="fc">&nbsp;            enrollmentQuery.setInt( 4, currentSemester );</b>
<b class="fc">&nbsp;            enrollmentQuery.setString( 5, departmentID );</b>
<b class="fc">&nbsp;            enrollmentQuery.setString( 6, courseCategory );</b>
&nbsp;            // Maybe parameterize the default grade later on? Currently, the database will set the default grade by itself if you don&#39;t give it anything
&nbsp;            // Do I just assume that the call to insert was successful?
<b class="fc">&nbsp;            enrollmentQuery.executeUpdate();</b>
<b class="fc">&nbsp;            return true;</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( error.getMessage() );</b>
<b class="nc">&nbsp;            System.out.println( &quot;Enrollment Request Failed&quot; );</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean dropCourse( String courseCode, String entryNumber, int currentYear, int currentSemester ) {
&nbsp;        try {
<b class="nc">&nbsp;            PreparedStatement dropQuery = databaseConnection.prepareStatement( &quot;DELETE FROM student_course_registration WHERE course_code = ? AND entry_number = ? AND year = ? AND semester = ?&quot; );</b>
<b class="nc">&nbsp;            dropQuery.setString( 1, courseCode );</b>
<b class="nc">&nbsp;            dropQuery.setString( 2, entryNumber );</b>
<b class="nc">&nbsp;            dropQuery.setInt( 3, currentYear );</b>
<b class="nc">&nbsp;            dropQuery.setInt( 4, currentSemester );</b>
<b class="nc">&nbsp;            int dropQueryResult = dropQuery.executeUpdate();</b>
<b class="nc">&nbsp;            return dropQueryResult == 1;</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Try again later&quot; );</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String[][] getAllRecords( String entryNumber ) {
&nbsp;        try {
<b class="fc">&nbsp;            PreparedStatement recordsQuery = databaseConnection.prepareStatement( &quot;SELECT credits, grade FROM student_course_registration NATURAL JOIN course_catalog WHERE entry_number = ?&quot; );</b>
<b class="fc">&nbsp;            recordsQuery.setString( 1, entryNumber );</b>
<b class="fc">&nbsp;            ResultSet recordsQueryResult = recordsQuery.executeQuery();</b>
&nbsp;
<b class="fc">&nbsp;            ArrayList&lt;String[]&gt; records = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;            while ( recordsQueryResult.next() ) {</b>
<b class="nc">&nbsp;                String credits = recordsQueryResult.getString( 1 );</b>
<b class="nc">&nbsp;                String grade   = recordsQueryResult.getString( 2 );</b>
<b class="nc">&nbsp;                records.add( new String[]{ credits, grade } );</b>
<b class="nc">&nbsp;            }</b>
<b class="fc">&nbsp;            return records.toArray( new String[records.size()][] );</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Try again later&quot; );</b>
<b class="nc">&nbsp;            return new String[][]{};</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String[][] getOfferedCourses( int currentYear, int currentSemester ) {
&nbsp;        try {
<b class="nc">&nbsp;            PreparedStatement getCoursesQuery = databaseConnection.prepareStatement( &quot;SELECT course_code, course_title, name, pre_requisites, department_id FROM course_offerings NATURAL JOIN course_catalog NATURAL JOIN faculty WHERE year = ? AND semester = ?&quot; );</b>
<b class="nc">&nbsp;            getCoursesQuery.setInt( 1, currentYear );</b>
<b class="nc">&nbsp;            getCoursesQuery.setInt( 2, currentSemester );</b>
<b class="nc">&nbsp;            ResultSet getCoursesQueryResult = getCoursesQuery.executeQuery();</b>
&nbsp;
<b class="nc">&nbsp;            ArrayList&lt;String[]&gt; records = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            while ( getCoursesQueryResult.next() ) {</b>
<b class="nc">&nbsp;                String course_code    = getCoursesQueryResult.getString( 1 );</b>
<b class="nc">&nbsp;                String course_title   = getCoursesQueryResult.getString( 2 );</b>
<b class="nc">&nbsp;                String faculty_name   = getCoursesQueryResult.getString( 3 );</b>
<b class="nc">&nbsp;                String pre_requisites = getCoursesQueryResult.getString( 4 );</b>
<b class="nc">&nbsp;                String departmentID   = getCoursesQueryResult.getString( 5 );</b>
<b class="nc">&nbsp;                records.add( new String[]{ course_code, course_title, faculty_name, pre_requisites, departmentID } );</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            return records.toArray( new String[records.size()][] );</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Try again later&quot; );</b>
<b class="nc">&nbsp;            return new String[][]{};</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isCurrentEventEnrolling( int currentYear, int currentSemester ) {
&nbsp;        try {
&nbsp;            // SQL query to check if the current event in the given session is enrolling
<b class="fc">&nbsp;            PreparedStatement offeringCheckQuery = databaseConnection.prepareStatement(&quot;SELECT * FROM current_year_and_semester WHERE year = ? AND semester = ? AND current_event = &#39;ENROLLING&#39;&quot;);</b>
<b class="fc">&nbsp;            offeringCheckQuery.setInt( 1, currentYear );</b>
<b class="fc">&nbsp;            offeringCheckQuery.setInt( 2, currentSemester );</b>
<b class="fc">&nbsp;            ResultSet offeringCheckQueryResult = offeringCheckQuery.executeQuery();</b>
&nbsp;
&nbsp;            // If there exists such a record, it implies that the current session is offering
<b class="fc">&nbsp;            return offeringCheckQueryResult.next();</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Please try again later&quot; );</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getCGPACriteria( String courseCode, int currentYear, int currentSemester, String courseDepartment ) {
&nbsp;        try {
&nbsp;            // SQL query to fetch the CGPA criteria from the database
<b class="fc">&nbsp;            PreparedStatement getCriteriaQuery = databaseConnection.prepareStatement(&quot;SELECT cgpa_criteria FROM course_offerings WHERE course_code = ? AND year = ? AND semester = ? AND department_id = ?&quot;);</b>
<b class="fc">&nbsp;            getCriteriaQuery.setString( 1, courseCode );</b>
<b class="fc">&nbsp;            getCriteriaQuery.setInt( 2, currentYear );</b>
<b class="fc">&nbsp;            getCriteriaQuery.setInt( 3, currentSemester );</b>
<b class="fc">&nbsp;            getCriteriaQuery.setString( 4, courseDepartment );</b>
<b class="fc">&nbsp;            ResultSet getCriteriaQueryResult = getCriteriaQuery.executeQuery();</b>
<b class="fc">&nbsp;            getCriteriaQueryResult.next();</b>
<b class="fc">&nbsp;            return getCriteriaQueryResult.getDouble( 1 );</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Please try again later&quot; );</b>
<b class="nc">&nbsp;            return 11;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public HashMap&lt;String, String[]&gt; getAllOfferings( String courseCode, int year, int semester, String courseDepartment ) {
&nbsp;        try {
&nbsp;            // Create the SQL query that will fetch all the departments and batches for which the course was offered
<b class="fc">&nbsp;            PreparedStatement getOfferingsQuery = databaseConnection.prepareStatement( &quot;SELECT sc, se, gr, pc, pe, hc, he, cp, ii, nn, oe FROM course_offerings WHERE course_code = ? AND year = ? AND semester = ? AND department_id = ?&quot; );</b>
<b class="fc">&nbsp;            getOfferingsQuery.setString( 1, courseCode );</b>
<b class="fc">&nbsp;            getOfferingsQuery.setInt( 2, year );</b>
<b class="fc">&nbsp;            getOfferingsQuery.setInt( 3, semester );</b>
<b class="fc">&nbsp;            getOfferingsQuery.setString( 4, courseDepartment );</b>
<b class="fc">&nbsp;            ResultSet getOfferingsQueryResult = getOfferingsQuery.executeQuery();</b>
&nbsp;
&nbsp;            // Now you have to copy the contents of the result set into a hashmap
&nbsp;            // Whatever categories are allowed in the database must be returned to the client side application
&nbsp;            // The order in the array must be the same as in the query
<b class="fc">&nbsp;            String[]                  categories = new String[]{ &quot;SC&quot;, &quot;SE&quot;, &quot;GR&quot;, &quot;PC&quot;, &quot;PE&quot;, &quot;HC&quot;, &quot;HE&quot;, &quot;CP&quot;, &quot;II&quot;, &quot;NN&quot;, &quot;OE&quot; };</b>
<b class="fc">&nbsp;            HashMap&lt;String, String[]&gt; offerings  = new HashMap&lt;&gt;();</b>
&nbsp;
&nbsp;            // Get the records corresponding to the categories and put them into the hashmap
<b class="fc">&nbsp;            while ( getOfferingsQueryResult.next() ) {</b>
<b class="fc">&nbsp;                for ( int i = 0; i &lt; categories.length; i++ ) {</b>
<b class="fc">&nbsp;                    Array    sqlColumn       = getOfferingsQueryResult.getArray( i + 1 );</b>
<b class="fc">&nbsp;                    String[] batchDepartment = (String[]) sqlColumn.getArray();</b>
<b class="fc">&nbsp;                    offerings.put( categories[i], batchDepartment );</b>
&nbsp;                }
&nbsp;            }
&nbsp;
&nbsp;            // You need as many results as there are categories, otherwise something has gone wrong
<b class="fc">&nbsp;            if ( offerings.size() != categories.length ) throw new RuntimeException( &quot;Exception&quot; );</b>
&nbsp;
&nbsp;            // If all conditions have been fulfilled, return the hashmap
<b class="fc">&nbsp;            return offerings;</b>
<b class="nc">&nbsp;        } catch ( Exception error ) {</b>
<b class="nc">&nbsp;            System.out.println( &quot;Database Error. Please try again later&quot; );</b>
<b class="nc">&nbsp;            return new HashMap&lt;&gt;();</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-02-18 19:12</div>
</div>
</body>
</html>
