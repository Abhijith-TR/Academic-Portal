<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PostgresAdminDAO.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Tests in 'client' Coverage Results</a> &gt; <a href="index.source.html" class="el_package">org.abhijith.dal</a> &gt; <span class="el_source">PostgresAdminDAO.java</span></div><h1>PostgresAdminDAO.java</h1><pre class="source lang-java linenums">package org.abhijith.dal;

import org.abhijith.daoInterfaces.AdminDAO;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;

public class PostgresAdminDAO extends PostgresCommonDAO implements AdminDAO {
    public PostgresAdminDAO() {
<span class="fc" id="L11">        super();</span>
<span class="fc" id="L12">    }</span>

    public String[][] getGradesOfCourse( String courseCode, int year, int semester, String offeringDepartment ) {
        try {
<span class="fc bfc" id="L16" title="All 8 branches covered.">            if ( courseCode == null || offeringDepartment == null || year &lt; 0 || semester &lt; 0 )</span>
<span class="fc" id="L17">                return new String[][]{};</span>
<span class="fc" id="L18">            courseCode = courseCode.toUpperCase();</span>
<span class="fc" id="L19">            offeringDepartment = offeringDepartment.toUpperCase();</span>

            // SQL query to fetch the records for a student from the database
<span class="fc" id="L22">            PreparedStatement getGradesQuery = databaseConnection.prepareStatement( &quot;SELECT entry_number, grade FROM student_course_registration WHERE course_code = ? AND year = ? AND semester = ? AND department_id = ? ORDER BY entry_number&quot; );</span>
<span class="fc" id="L23">            getGradesQuery.setString( 1, courseCode );</span>
<span class="fc" id="L24">            getGradesQuery.setInt( 2, year );</span>
<span class="fc" id="L25">            getGradesQuery.setInt( 3, semester );</span>
<span class="fc" id="L26">            getGradesQuery.setString( 4, offeringDepartment );</span>
<span class="fc" id="L27">            ResultSet getGradesQueryResult = getGradesQuery.executeQuery();</span>

            // Get the records from the ResultSet and put them into the required format
<span class="fc" id="L30">            ArrayList&lt;String[]&gt; records = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L31" title="All 2 branches covered.">            while ( getGradesQueryResult.next() ) {</span>
                // Every array is going to be { Entry Number, Grade }
<span class="fc" id="L33">                String entry_number = getGradesQueryResult.getString( 1 );</span>
<span class="fc" id="L34">                String grade        = getGradesQueryResult.getString( 2 );</span>
<span class="fc" id="L35">                records.add( new String[]{ entry_number, grade } );</span>
<span class="fc" id="L36">            }</span>

            // Convert the ArrayList into an array before returning
<span class="fc" id="L39">            return records.toArray( new String[records.size()][] );</span>
<span class="fc" id="L40">        } catch ( Exception error ) {</span>
<span class="fc" id="L41">            System.out.println( &quot;Database Error. Please try again later&quot; );</span>
<span class="fc" id="L42">            return new String[][]{};</span>
        }
    }

    public boolean insertStudent( String entryNumber, String name, String departmentID, int batch ) {
        try {
<span class="fc bfc" id="L48" title="All 8 branches covered.">            if ( entryNumber == null || name == null || departmentID == null || batch &lt; 0 ) return false;</span>
<span class="fc" id="L49">            entryNumber = entryNumber.toUpperCase();</span>
<span class="fc" id="L50">            name = name.toUpperCase();</span>
<span class="fc" id="L51">            departmentID = departmentID.toUpperCase();</span>

            // The default username and password for the STUDENT role
<span class="fc" id="L54">            final String DEFAULT_PASSWORD = &quot;iitropar&quot;;</span>
<span class="fc" id="L55">            final String STUDENT_ROLE     = &quot;STUDENT&quot;;</span>

            // SQL query to insert a student into the student relation which would allow him to enroll in various courses
<span class="fc" id="L58">            PreparedStatement insertStudentQuery = databaseConnection.prepareStatement( &quot;INSERT INTO student(entry_number, name, department_id, batch) VALUES (?, ?, ?, ?)&quot; );</span>
<span class="fc" id="L59">            insertStudentQuery.setString( 1, entryNumber );</span>
<span class="fc" id="L60">            insertStudentQuery.setString( 2, name );</span>
<span class="fc" id="L61">            insertStudentQuery.setString( 3, departmentID );</span>
<span class="fc" id="L62">            insertStudentQuery.setInt( 4, batch );</span>
<span class="fc" id="L63">            int successStatus = insertStudentQuery.executeUpdate();</span>

            // SQL query to insert the student into the common_user_details relation to allow him to log into the database
<span class="fc" id="L66">            PreparedStatement insertPasswordQuery = databaseConnection.prepareStatement( &quot;INSERT INTO common_user_details VALUES (?, ?, ?)&quot; );</span>
<span class="fc" id="L67">            insertPasswordQuery.setString( 1, entryNumber );</span>
            // The default password is set here
<span class="fc" id="L69">            insertPasswordQuery.setString( 2, DEFAULT_PASSWORD );</span>
<span class="fc" id="L70">            insertPasswordQuery.setString( 3, STUDENT_ROLE );</span>
<span class="fc" id="L71">            successStatus &amp;= insertPasswordQuery.executeUpdate();</span>

            // Returns true only if both queries execute successfully
<span class="pc bpc" id="L74" title="1 of 2 branches missed.">            return successStatus == 1;</span>
<span class="fc" id="L75">        } catch ( Exception error ) {</span>
<span class="fc" id="L76">            System.out.println( &quot;Database Error. Please try again later&quot; );</span>
<span class="fc" id="L77">            return false;</span>
        }
    }

    public boolean insertFaculty( String facultyID, String name, String departmentID ) {
        try {
<span class="fc bfc" id="L83" title="All 6 branches covered.">            if ( facultyID == null || name == null || departmentID == null ) return false;</span>
<span class="fc" id="L84">            facultyID = facultyID.toUpperCase();</span>
<span class="fc" id="L85">            name = name.toUpperCase();</span>
<span class="fc" id="L86">            departmentID = departmentID.toUpperCase();</span>

            // The default password for the FACULTY is set here
<span class="fc" id="L89">            final String DEFAULT_PASSWORD = &quot;iitropar&quot;;</span>
<span class="fc" id="L90">            final String FACULTY_ROLE     = &quot;FACULTY&quot;;</span>

            // SQL query to insert a faculty into the faculty table
<span class="fc" id="L93">            PreparedStatement insertFacultyQuery = databaseConnection.prepareStatement( &quot;INSERT INTO faculty(faculty_id, name, department_id) VALUES (?, ?, ?)&quot; );</span>
<span class="fc" id="L94">            insertFacultyQuery.setString( 1, facultyID );</span>
<span class="fc" id="L95">            insertFacultyQuery.setString( 2, name );</span>
<span class="fc" id="L96">            insertFacultyQuery.setString( 3, departmentID );</span>
<span class="fc" id="L97">            int successStatus = insertFacultyQuery.executeUpdate();</span>

            // SQL table to insert the login details for the new FACULTY
<span class="fc" id="L100">            PreparedStatement insertPasswordQuery = databaseConnection.prepareStatement( &quot;INSERT INTO common_user_details VALUES (?, ?, ?)&quot; );</span>
<span class="fc" id="L101">            insertPasswordQuery.setString( 1, facultyID );</span>
            // the default password is set here
<span class="fc" id="L103">            insertPasswordQuery.setString( 2, DEFAULT_PASSWORD );</span>
<span class="fc" id="L104">            insertPasswordQuery.setString( 3, FACULTY_ROLE );</span>
<span class="fc" id="L105">            successStatus &amp;= insertPasswordQuery.executeUpdate();</span>

            // Returns true only if both statements execute successfully
<span class="pc bpc" id="L108" title="1 of 2 branches missed.">            return successStatus == 1;</span>
<span class="fc" id="L109">        } catch ( Exception error ) {</span>
<span class="fc" id="L110">            System.out.println( &quot;Database Error. Please try again later&quot; );</span>
<span class="fc" id="L111">            return false;</span>
        }
    }

    public boolean insertCourse( String courseCode, String courseTitle, double[] creditStructure, String[] prerequisites ) {
        try {
            // Verify that the input parameters are valid
<span class="fc bfc" id="L118" title="All 10 branches covered.">            if ( courseCode == null || courseTitle == null || creditStructure == null || creditStructure.length != 5 || prerequisites == null )</span>
<span class="fc" id="L119">                return false;</span>
            // The course parameters cannot be negative
<span class="fc bfc" id="L121" title="All 4 branches covered.">            for ( double field : creditStructure ) if ( field &lt; 0 ) return false;</span>
            // Converting all the course codes to uppercase
<span class="fc bfc" id="L123" title="All 2 branches covered.">            for ( int i = 0; i &lt; prerequisites.length; i++ ) {</span>
<span class="fc bfc" id="L124" title="All 2 branches covered.">                if ( prerequisites[i] == null ) return false;</span>
<span class="fc" id="L125">                prerequisites[i] = prerequisites[i].toUpperCase();</span>
            }
<span class="fc" id="L127">            courseCode = courseCode.toUpperCase();</span>
<span class="fc" id="L128">            courseTitle = courseTitle.toUpperCase();</span>

            // SQL query to insert a course into the course catalog
<span class="fc" id="L131">            PreparedStatement insertCourseQuery = databaseConnection.prepareStatement( &quot;INSERT INTO course_catalog VALUES(?, ?, ?, ?, ?, ?, ?, ?)&quot; );</span>
<span class="fc" id="L132">            insertCourseQuery.setString( 1, courseCode );</span>
<span class="fc" id="L133">            insertCourseQuery.setString( 2, courseTitle );</span>
<span class="fc" id="L134">            insertCourseQuery.setDouble( 3, creditStructure[0] );</span>
<span class="fc" id="L135">            insertCourseQuery.setDouble( 4, creditStructure[1] );</span>
<span class="fc" id="L136">            insertCourseQuery.setDouble( 5, creditStructure[2] );</span>
<span class="fc" id="L137">            insertCourseQuery.setDouble( 6, creditStructure[3] );</span>
<span class="fc" id="L138">            insertCourseQuery.setDouble( 7, creditStructure[4] );</span>
<span class="fc" id="L139">            insertCourseQuery.setObject( 8, prerequisites );</span>
<span class="fc" id="L140">            int insertCourseQueryResult = insertCourseQuery.executeUpdate();</span>

            // Returns 1 if the course could not be inserted into the course catalog
<span class="pc bpc" id="L143" title="1 of 2 branches missed.">            return insertCourseQueryResult == 1;</span>
<span class="fc" id="L144">        } catch ( Exception error ) {</span>
<span class="fc" id="L145">            System.out.println( &quot;Database Error. Please try again later&quot; );</span>
<span class="fc" id="L146">            return false;</span>
        }
    }

    @Override
    public boolean checkAllPrerequisites( String[] prerequisites ) {
        try {
<span class="fc bfc" id="L153" title="All 2 branches covered.">            if ( prerequisites == null ) return false;</span>
<span class="fc bfc" id="L154" title="All 2 branches covered.">            for ( int i = 0; i &lt; prerequisites.length; i++ ) {</span>
<span class="fc bfc" id="L155" title="All 2 branches covered.">                if ( prerequisites[i] == null ) return false;</span>
<span class="fc" id="L156">                prerequisites[i] = prerequisites[i].toUpperCase();</span>
            }

            // Iterate through the list of prerequisites
<span class="fc" id="L160">            boolean coursesFound = true;</span>
<span class="fc bfc" id="L161" title="All 2 branches covered.">            for ( String course : prerequisites ) {</span>
                // True only if all the course codes are found in the course catalog
<span class="fc" id="L163">                PreparedStatement findCourseQuery = databaseConnection.prepareStatement( &quot;SELECT course_code FROM course_catalog WHERE course_code = ?&quot; );</span>
<span class="fc" id="L164">                findCourseQuery.setString( 1, course );</span>
<span class="fc" id="L165">                ResultSet findCourseQueryResult = findCourseQuery.executeQuery();</span>
<span class="fc" id="L166">                coursesFound &amp;= findCourseQueryResult.next();</span>
            }
<span class="fc" id="L168">            return coursesFound;</span>
<span class="fc" id="L169">        } catch ( Exception error ) {</span>
<span class="fc" id="L170">            System.out.println( &quot;Database Error. Please try again later&quot; );</span>
<span class="fc" id="L171">            return false;</span>
        }
    }

    @Override
    public boolean dropCourseFromCatalog( String courseCode ) {
        try {
<span class="fc bfc" id="L178" title="All 2 branches covered.">            if ( courseCode == null ) return false;</span>

            // SQL query to delete the course from the course catalog
<span class="fc" id="L181">            PreparedStatement dropCourseQuery = databaseConnection.prepareStatement( &quot;DELETE FROM course_catalog WHERE course_code = ?&quot; );</span>
<span class="fc" id="L182">            dropCourseQuery.setString( 1, courseCode );</span>
<span class="fc" id="L183">            int dropCourseQueryResult = dropCourseQuery.executeUpdate();</span>

            // Returns true if the course was deleted, false otherwise
<span class="fc bfc" id="L186" title="All 2 branches covered.">            return dropCourseQueryResult == 1;</span>
<span class="fc" id="L187">        } catch ( Exception error ) {</span>
<span class="fc" id="L188">            System.out.println( &quot;Database Error. Please try again later&quot; );</span>
<span class="fc" id="L189">            return false;</span>
        }
    }

    @Override
    public boolean createBatch( int batchYear ) {
        try {
<span class="fc bfc" id="L196" title="All 2 branches covered.">            if ( batchYear &lt; 0 ) return false;</span>

            // SQL query to insert a batch into the database
<span class="fc" id="L199">            PreparedStatement createBatchQuery = databaseConnection.prepareStatement( &quot;INSERT INTO batch VALUES(?)&quot; );</span>
<span class="fc" id="L200">            createBatchQuery.setInt( 1, batchYear );</span>
<span class="fc" id="L201">            int createBatchQueryResult = createBatchQuery.executeUpdate();</span>

            // Returns true as long as the course executes. If a batch is repeated, the error is triggered and a false is returned
<span class="pc bpc" id="L204" title="1 of 2 branches missed.">            return createBatchQueryResult == 1;</span>
<span class="fc" id="L205">        } catch ( Exception error ) {</span>
<span class="fc" id="L206">            System.out.println( &quot;Database Error. Something went wrong&quot; );</span>
<span class="fc" id="L207">            return false;</span>
        }
    }

    @Override
    public boolean createCurriculum( int batchYear, double[] creditRequirements ) {
        try {
<span class="fc bfc" id="L214" title="All 6 branches covered.">            if ( batchYear &lt; 0 || creditRequirements == null || creditRequirements.length != 11 ) return false;</span>
<span class="pc bpc" id="L215" title="1 of 4 branches missed.">            for ( double creditRequirement : creditRequirements ) if ( creditRequirement &lt; 0 ) return false;</span>

            // SQL query to insert the curriculum into the database for the corresponding batch
<span class="fc" id="L218">            PreparedStatement createCurriculumQuery = databaseConnection.prepareStatement( &quot;INSERT INTO ug_curriculum VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)&quot; );</span>
<span class="fc" id="L219">            createCurriculumQuery.setInt( 1, batchYear );</span>

            // Iterate through all the categories and set them
<span class="fc bfc" id="L222" title="All 2 branches covered.">            for ( int i = 2; i &lt;= 12; i++ ) {</span>
<span class="fc" id="L223">                createCurriculumQuery.setDouble( i, creditRequirements[i - 2] );</span>
            }
<span class="fc" id="L225">            int createCurriculumQueryResult = createCurriculumQuery.executeUpdate();</span>
            // Returns true if the curriculum was inserted successfully
<span class="pc bpc" id="L227" title="1 of 2 branches missed.">            return createCurriculumQueryResult == 1;</span>
<span class="fc" id="L228">        } catch ( Exception error ) {</span>
<span class="fc" id="L229">            System.out.println( &quot;Database Error. Something went wrong&quot; );</span>
<span class="fc" id="L230">            return false;</span>
        }
    }

    @Override
    public boolean insertCoreCourse( String courseCode, String[] departmentCodes, int batch, String courseCategory ) {
        try {
<span class="fc bfc" id="L237" title="All 8 branches covered.">            if ( courseCode == null || departmentCodes == null || batch &lt; 0 || courseCategory == null ) return false;</span>
<span class="fc bfc" id="L238" title="All 2 branches covered.">            for ( int i = 0; i &lt; departmentCodes.length; i++ ) {</span>
<span class="fc bfc" id="L239" title="All 2 branches covered.">                if ( departmentCodes[i] == null ) return false;</span>
<span class="fc" id="L240">                departmentCodes[i] = departmentCodes[i].toUpperCase();</span>
            }
<span class="fc" id="L242">            courseCategory = courseCategory.toUpperCase();</span>
<span class="fc" id="L243">            courseCode = courseCode.toUpperCase();</span>

<span class="fc" id="L245">            int               insertCourseQueryResult = 1;</span>
            // SQL query to insert the course code into the database
<span class="fc" id="L247">            PreparedStatement insertCourseQuery       = databaseConnection.prepareStatement( &quot;INSERT INTO core_courses VALUES (?, ?, ?, ?)&quot; );</span>
<span class="fc" id="L248">            insertCourseQuery.setString( 1, courseCode );</span>
<span class="fc" id="L249">            insertCourseQuery.setInt( 3, batch );</span>
<span class="fc" id="L250">            insertCourseQuery.setString( 4, courseCategory );</span>
            // Set the department of the corresponding course into the database
<span class="fc bfc" id="L252" title="All 2 branches covered.">            for ( String department : departmentCodes ) {</span>
<span class="fc" id="L253">                insertCourseQuery.setString( 2, department );</span>
<span class="fc" id="L254">                insertCourseQueryResult &amp;= insertCourseQuery.executeUpdate();</span>
            }
<span class="pc bpc" id="L256" title="1 of 2 branches missed.">            return insertCourseQueryResult == 1;</span>
<span class="fc" id="L257">        } catch ( Exception error ) {</span>
<span class="fc" id="L258">            System.out.println( &quot;Database Error. Please check that all courses exist in the course catalog&quot; );</span>
<span class="fc" id="L259">            return false;</span>
        }
    }

    @Override
    public boolean resetCoreCoursesList( int batch ) {
        try {
            // Delete all the core courses of the particular batch from the core_courses table
<span class="fc" id="L267">            PreparedStatement resetCoreCoursesQuery = databaseConnection.prepareStatement( &quot;DELETE FROM core_courses WHERE batch = ?&quot; );</span>
<span class="fc" id="L268">            resetCoreCoursesQuery.setInt( 1, batch );</span>
<span class="fc" id="L269">            resetCoreCoursesQuery.executeUpdate();</span>

            // If the query executes successfully return true i.e., the table is ready to be inserted into again
<span class="fc" id="L272">            return true;</span>
<span class="fc" id="L273">        } catch ( Exception error ) {</span>
            // If the table is not found, or the database connection has failed
<span class="fc" id="L275">            System.out.println( &quot;Database Error. Please try again later&quot; );</span>
            // Return the fact that the database operation was not executed
<span class="fc" id="L277">            return false;</span>
        }
    }

    @Override
    public boolean findEntryNumber( String entryNumber ) {
        try {
<span class="fc bfc" id="L284" title="All 2 branches covered.">            if ( entryNumber == null ) return false;</span>

            // Generate the SQL query that will check if the student exists
<span class="fc" id="L287">            PreparedStatement findEntryNumberQuery = databaseConnection.prepareStatement( &quot;SELECT name FROM student WHERE entry_number = ?&quot; );</span>
<span class="fc" id="L288">            findEntryNumberQuery.setString( 1, entryNumber );</span>
<span class="fc" id="L289">            ResultSet findEntryNumberQueryResult = findEntryNumberQuery.executeQuery();</span>

            // True if the query has found anything, false otherwise
<span class="fc" id="L292">            return findEntryNumberQueryResult.next();</span>
<span class="fc" id="L293">        } catch ( Exception error ) {</span>
<span class="fc" id="L294">            System.out.println( &quot;Database Error. Please try again later&quot; );</span>
<span class="fc" id="L295">            return false;</span>
        }
    }

    @Override
    public String[] getCoreCourses( int batch, String studentDepartment ) {
        try {
<span class="fc bfc" id="L302" title="All 4 branches covered.">            if ( batch &lt; 0 || studentDepartment == null ) return null;</span>

            // Execute the SQL statement that will get all the core courses of a particular department in a particular year
<span class="fc" id="L305">            PreparedStatement getCoreCoursesQuery = databaseConnection.prepareStatement( &quot;SELECT course_code FROM core_courses WHERE batch = ? AND department_id = ?&quot; );</span>
<span class="fc" id="L306">            getCoreCoursesQuery.setInt( 1, batch );</span>
<span class="fc" id="L307">            getCoreCoursesQuery.setString( 2, studentDepartment );</span>
<span class="fc" id="L308">            ResultSet getCoreCoursesQueryResult = getCoreCoursesQuery.executeQuery();</span>

            // Now we have to fetch all the course codes into an arraylist that will be converted into a string array
<span class="fc" id="L311">            ArrayList&lt;String&gt; coreCourses = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L312" title="All 2 branches covered.">            while ( getCoreCoursesQueryResult.next() ) {</span>
<span class="fc" id="L313">                String courseCode = getCoreCoursesQueryResult.getString( 1 );</span>
<span class="fc" id="L314">                coreCourses.add( courseCode );</span>
<span class="fc" id="L315">            }</span>
            // Return the array list converted to a string array
<span class="fc" id="L317">            return coreCourses.toArray( new String[coreCourses.size()] );</span>
<span class="fc" id="L318">        } catch ( Exception error ) {</span>
<span class="fc" id="L319">            System.out.println( &quot;Database Error. Please try again later&quot; );</span>
<span class="fc" id="L320">            return null;</span>
        }
    }

    @Override
    public String[] getListOfStudentsInBatch( int batch, String department ) {
        try {
<span class="fc bfc" id="L327" title="All 4 branches covered.">            if ( batch &lt; 0 || department == null ) return null;</span>

            // Execute the SQL query to fetch all the students of this department from this batch
<span class="fc" id="L330">            PreparedStatement getStudentsQuery = databaseConnection.prepareStatement( &quot;SELECT entry_number FROM student WHERE batch = ? AND department_id = ?&quot; );</span>
<span class="fc" id="L331">            getStudentsQuery.setInt( 1, batch );</span>
<span class="fc" id="L332">            getStudentsQuery.setString( 2, department );</span>
<span class="fc" id="L333">            ResultSet getStudentsQueryResult = getStudentsQuery.executeQuery();</span>

            // Now get the list of students returned by the query into a string array
<span class="fc" id="L336">            ArrayList&lt;String&gt; studentsList = new ArrayList&lt;&gt;();</span>

            // Get all the entry numbers from the result set
<span class="fc bfc" id="L339" title="All 2 branches covered.">            while ( getStudentsQueryResult.next() ) {</span>
<span class="fc" id="L340">                String entryNumber = getStudentsQueryResult.getString( 1 );</span>
<span class="fc" id="L341">                studentsList.add( entryNumber );</span>
<span class="fc" id="L342">            }</span>

            // Return the array list converted into a string array
<span class="fc" id="L345">            return studentsList.toArray( new String[studentsList.size()] );</span>
<span class="fc" id="L346">        } catch ( Exception error ) {</span>
<span class="fc" id="L347">            System.out.println( &quot;Database Error. Please try again later&quot; );</span>
<span class="fc" id="L348">            return null;</span>
        }
    }

    @Override
    public boolean checkIfSessionCompleted( int year, int semester ) {
        try {
<span class="fc bfc" id="L355" title="All 4 branches covered.">            if ( year &lt; 0 || semester &lt; 0 ) return false;</span>

            // Get the status of the session that was provided
<span class="fc" id="L358">            PreparedStatement getSessionQuery = databaseConnection.prepareStatement( &quot;SELECT current_event FROM current_year_and_semester WHERE year = ? AND semester = ?&quot; );</span>
<span class="fc" id="L359">            getSessionQuery.setInt( 1, year );</span>
<span class="fc" id="L360">            getSessionQuery.setInt( 2, semester );</span>
<span class="fc" id="L361">            ResultSet getSessionQueryResult = getSessionQuery.executeQuery();</span>

            // Check if the given session contains an entry in the database
<span class="fc" id="L364">            boolean isSessionValid = getSessionQueryResult.next();</span>
<span class="pc bpc" id="L365" title="1 of 2 branches missed.">            if ( !isSessionValid ) return false;</span>

            // If the session exists, we need to check if the session is completed
<span class="fc" id="L368">            String courseStatus = getSessionQueryResult.getString( 1 );</span>
<span class="fc" id="L369">            return courseStatus.equals( &quot;COMPLETED&quot; );</span>
<span class="fc" id="L370">        } catch ( Exception error ) {</span>
<span class="fc" id="L371">            System.out.println( &quot;Database Error. Please try again later&quot; );</span>
<span class="fc" id="L372">            return false;</span>
        }
    }

    @Override
    public boolean createNewSession( int newYear, int newSemester ) {
        try {
<span class="fc bfc" id="L379" title="All 4 branches covered.">            if ( newYear &lt; 0 || newSemester &lt; 0 ) return false;</span>

            // Create an SQL query to insert the session into the database
<span class="fc" id="L382">            PreparedStatement createSessionQuery = databaseConnection.prepareStatement( &quot;INSERT INTO current_year_and_semester( year, semester ) VALUES(?, ?)&quot; );</span>
<span class="fc" id="L383">            createSessionQuery.setInt( 1, newYear );</span>
<span class="fc" id="L384">            createSessionQuery.setInt( 2, newSemester );</span>

            // Return true only if a new session was created in the database, false otherwise
<span class="pc bpc" id="L387" title="1 of 2 branches missed.">            return createSessionQuery.executeUpdate() == 1;</span>
<span class="fc" id="L388">        } catch ( Exception error ) {</span>
<span class="fc" id="L389">            System.out.println( &quot;Database error. Please try again later&quot; );</span>
<span class="fc" id="L390">            return false;</span>
        }
    }

    @Override
    public boolean setSessionEvent( String event, int currentYear, int currentSemester ) {
        try {
<span class="fc bfc" id="L397" title="All 6 branches covered.">            if ( event == null || currentSemester &lt; 0 || currentYear &lt; 0 ) return false;</span>
            // These are the only statuses that are allowed. If the user has entered a completely different status, it must be rejected
<span class="fc" id="L399">            String[] availableEvents = new String[]{ &quot;RUNNING&quot;, &quot;ENROLLING&quot;, &quot;OFFERING&quot;, &quot;GRADE SUBMISSION&quot;, &quot;COMPLETED&quot; };</span>

            // Go through all the valid events and check if this particular event is found in the list
<span class="fc" id="L402">            boolean stringFound = false;</span>
<span class="fc bfc" id="L403" title="All 2 branches covered.">            for ( String temp : availableEvents ) {</span>
<span class="fc" id="L404">                stringFound |= temp.equals( event );</span>
            }
<span class="fc bfc" id="L406" title="All 2 branches covered.">            if ( !stringFound ) return false;</span>

            // SQL query to update the event in the database
<span class="fc" id="L409">            PreparedStatement setStatusQuery = databaseConnection.prepareStatement( &quot;UPDATE current_year_and_semester SET current_event = ? WHERE year = ? AND semester = ?&quot; );</span>
<span class="fc" id="L410">            setStatusQuery.setString( 1, event );</span>
<span class="fc" id="L411">            setStatusQuery.setInt( 2, currentYear );</span>
<span class="fc" id="L412">            setStatusQuery.setInt( 3, currentSemester );</span>
<span class="fc" id="L413">            setStatusQuery.executeUpdate();</span>

            // If the query was executed successfully the update was successful. The year and semester have been provided by us
<span class="fc" id="L416">            return true;</span>
<span class="fc" id="L417">        } catch ( Exception error ) {</span>
<span class="fc" id="L418">            System.out.println( &quot;Database Error. Please try again later&quot; );</span>
<span class="fc" id="L419">            return false;</span>
        }
    }

    @Override
    public boolean verifyNoMissingGrades( int currentYear, int currentSemester ) {
        try {
<span class="fc bfc" id="L426" title="All 4 branches covered.">            if ( currentYear &lt; 0 || currentSemester &lt; 0 ) return false;</span>

            // SQL query to check if there are any students in the previous semester who have not had their grades entered
            // '-' is used in the database to indicate that an entry has not yet been inserted
<span class="fc" id="L430">            PreparedStatement missingGradeQuery = databaseConnection.prepareStatement( &quot;SELECT * FROM student_course_registration WHERE year = ? AND semester = ? AND grade = '-'&quot; );</span>
<span class="fc" id="L431">            missingGradeQuery.setInt( 1, currentYear );</span>
<span class="fc" id="L432">            missingGradeQuery.setInt( 2, currentSemester );</span>
<span class="fc" id="L433">            ResultSet missingGradeQueryResult = missingGradeQuery.executeQuery();</span>

            // If any row was returned there is a missing grade in the session
<span class="fc bfc" id="L436" title="All 2 branches covered.">            return !missingGradeQueryResult.next();</span>
<span class="fc" id="L437">        } catch ( Exception error ) {</span>
<span class="fc" id="L438">            System.out.println( &quot;Database error. Please try again later&quot; );</span>
<span class="fc" id="L439">            return false;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>