<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Faculty.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Tests in 'client' Coverage Results</a> &gt; <a href="index.source.html" class="el_package">org.abhijith.users</a> &gt; <span class="el_source">Faculty.java</span></div><h1>Faculty.java</h1><pre class="source lang-java linenums">package org.abhijith.users;

import org.abhijith.dal.PostgresFacultyDAO;
import org.abhijith.daoInterfaces.FacultyDAO;

import java.io.BufferedReader;
import java.io.File;
import java.io.PrintWriter;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;

public class Faculty extends User {
    private FacultyDAO facultyDAO;

    public Faculty( String id ) {
<span class="fc" id="L17">        super( id );</span>
<span class="fc" id="L18">        this.facultyDAO = new PostgresFacultyDAO();</span>
<span class="fc" id="L19">        super.setCommonDAO( facultyDAO );</span>
<span class="fc" id="L20">    }</span>

    public void setFacultyDAO( FacultyDAO facultyDAO ) {
<span class="fc" id="L23">        this.facultyDAO = facultyDAO;</span>
<span class="fc" id="L24">    }</span>

    public boolean offerCourse( String courseCode, String offeringDepartment ) {
        // Checking the input
<span class="fc bfc" id="L28" title="All 4 branches covered.">        if ( courseCode == null || offeringDepartment == null ) return false;</span>

        // Checking if the course is present in the course catalog
<span class="fc" id="L31">        boolean isCoursePresent = facultyDAO.checkCourseCatalog( courseCode );</span>
<span class="fc bfc" id="L32" title="All 2 branches covered.">        if ( !isCoursePresent ) return false;</span>

        // Getting the current academic session as the instructor will only be allowed to insert records in the current semester
<span class="fc" id="L35">        int[] currentSession  = facultyDAO.getCurrentAcademicSession();</span>
<span class="fc" id="L36">        int   currentYear     = currentSession[0];</span>
<span class="fc" id="L37">        int   currentSemester = currentSession[1];</span>

        // Check if it is currently the offering event
<span class="fc bfc" id="L40" title="All 2 branches covered.">        if ( !facultyDAO.isCurrentEventOffering( currentYear, currentSemester ) ) return false;</span>

        // Check if the course is offered by your department
<span class="fc bfc" id="L43" title="All 2 branches covered.">        if ( facultyDAO.isCourseAlreadyOffered( courseCode, currentYear, currentSemester, offeringDepartment ) )</span>
<span class="fc" id="L44">            return false;</span>

        // Inserting the course into the database, being offered by the instructors department
<span class="fc" id="L47">        return facultyDAO.insertCourseOffering( courseCode, currentYear, currentSemester, offeringDepartment, this.id );</span>
    }

    public boolean setCGAndPrerequisites( String courseCode, String offeringDepartment, double minimumCGPA, String[][] prerequisites ) {
        try {
            // Checking the input that is given
<span class="fc bfc" id="L53" title="All 10 branches covered.">            if ( courseCode == null || minimumCGPA &lt; 0 || minimumCGPA &gt; 10 || prerequisites == null || offeringDepartment == null )</span>
<span class="fc" id="L54">                return false;</span>

            // Get the current academic session
<span class="fc" id="L57">            int[] currentAcademicSession = facultyDAO.getCurrentAcademicSession();</span>
<span class="fc" id="L58">            int   currentYear            = currentAcademicSession[0];</span>
<span class="fc" id="L59">            int   currentSemester        = currentAcademicSession[1];</span>

            // Check if it is currently the offering event
<span class="fc bfc" id="L62" title="All 2 branches covered.">            if ( !facultyDAO.isCurrentEventOffering( currentAcademicSession[0], currentAcademicSession[1] ) ) {</span>
<span class="fc" id="L63">                return false;</span>
            }

            // Check if this particular faculty is offering such a course
<span class="fc bfc" id="L67" title="All 2 branches covered.">            if ( !facultyDAO.checkIfOfferedBySelf( this.id, courseCode, currentYear, currentSemester, offeringDepartment ) )</span>
<span class="fc" id="L68">                return false;</span>

            // Set the minimum CGPA requirement, if no such entry is found, it simply returns false
<span class="fc" id="L71">            boolean isMinimumCGPASet = facultyDAO.setCGCriteria( this.id, courseCode, minimumCGPA, currentAcademicSession, offeringDepartment );</span>
<span class="fc bfc" id="L72" title="All 2 branches covered.">            if ( !isMinimumCGPASet ) return false;</span>

            // Check if all the courses entered as prerequisites are in the course catalog
<span class="fc" id="L75">            boolean isPrerequisitesValid = true;</span>
<span class="fc bfc" id="L76" title="All 2 branches covered.">            for ( String[] courseBatch : prerequisites ) {</span>
<span class="fc bfc" id="L77" title="All 2 branches covered.">                if ( courseBatch == null ) {</span>
<span class="fc" id="L78">                    return false;</span>
                }
<span class="fc bfc" id="L80" title="All 2 branches covered.">                for ( int i = 0; i &lt; courseBatch.length; i += 2 ) {</span>
<span class="fc" id="L81">                    isPrerequisitesValid &amp;= facultyDAO.checkCourseCatalog( courseBatch[i] );</span>
                }
            }
            // Only set the prerequisites if all the course codes entered are valid
<span class="fc bfc" id="L85" title="All 2 branches covered.">            if ( !isPrerequisitesValid ) return false;</span>
<span class="fc" id="L86">            return facultyDAO.setInstructorPrerequisites( offeringDepartment, courseCode, prerequisites, currentAcademicSession );</span>
<span class="fc" id="L87">        } catch ( Exception error ) {</span>
<span class="fc" id="L88">            return false;</span>
        }
    }

    public boolean dropCourseOffering( String courseCode, String offeringDepartment ) {
<span class="fc bfc" id="L93" title="All 4 branches covered.">        if ( courseCode == null || offeringDepartment == null ) return false;</span>

<span class="fc" id="L95">        int[] currentAcademicSession = facultyDAO.getCurrentAcademicSession();</span>
<span class="fc" id="L96">        int   currentYear            = currentAcademicSession[0];</span>
<span class="fc" id="L97">        int   currentSemester        = currentAcademicSession[1];</span>

        // Check if it is currently the offering event
<span class="fc bfc" id="L100" title="All 2 branches covered.">        if ( !facultyDAO.isCurrentEventOffering( currentYear, currentSemester ) ) return false;</span>

        // Check if the course has been offered by this faculty
<span class="fc bfc" id="L103" title="All 2 branches covered.">        if ( !facultyDAO.checkIfOfferedBySelf( this.id, courseCode, currentYear, currentSemester, offeringDepartment ) )</span>
<span class="fc" id="L104">            return false;</span>
<span class="fc" id="L105">        return facultyDAO.dropCourseOffering( this.id, courseCode, currentYear, currentSemester, offeringDepartment );</span>
    }

    private boolean verifyCore( String courseCode, String departmentID, int[] years ) {
        boolean isCore;
        // Iterate through all the years and verify that it is a core course for all of them
<span class="fc bfc" id="L111" title="All 2 branches covered.">        for ( int year : years ) {</span>
            // If the course is not core for a particular department in a particular year
<span class="fc" id="L113">            isCore = facultyDAO.verifyCore( courseCode, departmentID, year );</span>
            // Then this request to set type is not valid
<span class="fc bfc" id="L115" title="All 2 branches covered.">            if ( !isCore ) return false;</span>
        }
<span class="fc" id="L117">        return true;</span>
    }

    public boolean setCourseCategory( String courseCode, String offeringDepartment, String courseCategory, String departmentID, int[] years ) {
<span class="fc bfc" id="L121" title="All 10 branches covered.">        if ( courseCode == null || courseCategory == null || departmentID == null || years == null || offeringDepartment == null )</span>
<span class="fc" id="L122">            return false;</span>

        // Get the current year and semester
<span class="fc" id="L125">        int[] currentSession  = facultyDAO.getCurrentAcademicSession();</span>
<span class="fc" id="L126">        int   currentYear     = currentSession[0];</span>
<span class="fc" id="L127">        int   currentSemester = currentSession[1];</span>

        // Check if it is currently the offering event
<span class="fc bfc" id="L130" title="All 2 branches covered.">        if ( !facultyDAO.isCurrentEventOffering( currentYear, currentSemester ) ) return false;</span>

        // Check if this course code has been offered by this instructor in the current session
<span class="fc" id="L133">        boolean isOwnCourse = facultyDAO.checkIfOfferedBySelf( this.id, courseCode, currentYear, currentSemester, offeringDepartment );</span>

        // If not offered by this instructor, the course category cannot be set
<span class="fc bfc" id="L136" title="All 2 branches covered.">        if ( !isOwnCourse ) return false;</span>

        // If the course has been offered as a core course by the instructor, you have to verify that it is actually a core course for the particular year
<span class="fc bfc" id="L139" title="All 14 branches covered.">        if ( courseCategory.equals( &quot;PC&quot; ) || courseCategory.equals( &quot;SC&quot; ) || courseCategory.equals( &quot;GR&quot; ) || courseCategory.equals( &quot;HC&quot; ) || courseCategory.equals( &quot;CP&quot; ) || courseCategory.equals( &quot;II&quot; ) || courseCategory.equals( &quot;NN&quot; ) ) {</span>
<span class="fc" id="L140">            boolean isValidCore = verifyCore( courseCode, departmentID, years );</span>
<span class="fc bfc" id="L141" title="All 2 branches covered.">            if ( !isValidCore ) return false;</span>
        }

        // Now that the course has been verified, you can update the course category
<span class="fc" id="L145">        return facultyDAO.setCourseCategory( courseCode, currentYear, currentSemester, courseCategory, departmentID, years, offeringDepartment );</span>
    }

    public String[][][] getGradesOfStudent( String entryNumber ) {
<span class="fc bfc" id="L149" title="All 2 branches covered.">        if ( entryNumber == null ) return new String[][][]{};</span>
        // Arraylist to conveniently store records before returning to the UI layer
<span class="fc" id="L151">        ArrayList&lt;String[][]&gt; completeStudentRecords = new ArrayList&lt;&gt;();</span>

        // Getting the current academic session and the batch of the student
<span class="fc" id="L154">        int[] currentAcademicSession = facultyDAO.getCurrentAcademicSession();</span>
<span class="fc" id="L155">        int   studentBatch           = facultyDAO.getBatch( entryNumber );</span>
<span class="fc bfc" id="L156" title="All 2 branches covered.">        if ( studentBatch == -1 ) return new String[][][]{};</span>
<span class="fc" id="L157">        int currentYear     = currentAcademicSession[0];</span>
<span class="fc" id="L158">        int currentSemester = currentAcademicSession[1];</span>

        // Go through all the semesters from the students joining batch till the current academic session
<span class="fc bfc" id="L161" title="All 2 branches covered.">        for ( int year = studentBatch; year &lt;= currentYear; year++ ) {</span>
<span class="fc bfc" id="L162" title="All 2 branches covered.">            for ( int semester = 1; semester &lt;= 2; semester++ ) {</span>
                // Fetches the records for the particular student for this particular year and semester
<span class="fc" id="L164">                String[][] semesterRecords = facultyDAO.getStudentGradesForSemester( entryNumber, year, semester );</span>
<span class="fc" id="L165">                completeStudentRecords.add( semesterRecords );</span>

                // If we have reached the current semester, then break
<span class="fc bfc" id="L168" title="All 4 branches covered.">                if ( year == currentYear &amp;&amp; semester == currentSemester ) {</span>
<span class="fc" id="L169">                    break;</span>
                }
            }
        }
<span class="fc" id="L173">        return completeStudentRecords.toArray( new String[completeStudentRecords.size()][][] );</span>
    }

    public String[][] getGradesOfOffering( String courseCode, int year, int semester, String offeringDepartment ) {
<span class="fc bfc" id="L177" title="All 8 branches covered.">        if ( courseCode == null || offeringDepartment == null || year &lt; 0 || semester &lt; 0 ) return new String[][]{};</span>
<span class="fc" id="L178">        return facultyDAO.getGradesOfCourse( courseCode, year, semester, offeringDepartment );</span>
    }

    public boolean generateGradeCSV( String courseCode, int year, int semester, String offeringDepartment ) {
        try {
<span class="fc bfc" id="L183" title="All 8 branches covered.">            if ( courseCode == null || offeringDepartment == null || year &lt; 0 || semester &lt; 0 ) return false;</span>

            // Check if the course is offered by the currently logged in instructor
<span class="fc" id="L186">            boolean isOwnCourse = facultyDAO.checkIfOfferedBySelf( this.id, courseCode, year, semester, offeringDepartment );</span>
<span class="fc bfc" id="L187" title="All 2 branches covered.">            if ( !isOwnCourse ) {</span>
<span class="fc" id="L188">                return false;</span>
            }

            // Get the names of all students enrolled in this particular course offering
<span class="fc" id="L192">            String[][] records = facultyDAO.getCourseEnrollmentsList( courseCode, year, semester, offeringDepartment );</span>

            // Create a new file to insert the name and the entry number ( only the entry number is relevant for use in the program )
<span class="fc" id="L195">            String fileName        = courseCode + &quot;_&quot; + year + &quot;_&quot; + semester + &quot;_&quot; + offeringDepartment + &quot;.csv&quot;;</span>
<span class="fc" id="L196">            File   gradeUploadFile = new File( fileName );</span>

            // Create a printWriter to write into the newly created file
<span class="fc" id="L199">            PrintWriter fileWriter = new PrintWriter( gradeUploadFile );</span>

            // Iterate through all the name and entry numbers and insert them into the file separated by commas
<span class="fc bfc" id="L202" title="All 2 branches covered.">            for ( String[] record : records ) {</span>
<span class="fc" id="L203">                String lineContent = String.join( &quot;,&quot;, record ) + &quot;,&quot;;</span>
<span class="fc" id="L204">                fileWriter.println( lineContent );</span>
            }

            // Close the file that was written into
<span class="fc" id="L208">            fileWriter.close();</span>
<span class="fc" id="L209">            return true;</span>
<span class="fc" id="L210">        } catch ( Exception error ) {</span>
<span class="fc" id="L211">            return false;</span>
        }
    }

    public boolean uploadGrades( String courseCode, int year, int semester, BufferedReader gradeCSVFile, String offeringDepartment ) {
        try {
<span class="fc bfc" id="L217" title="All 10 branches covered.">            if ( courseCode == null || year &lt; 0 || semester &lt; 0 || gradeCSVFile == null || offeringDepartment == null )</span>
<span class="fc" id="L218">                return false;</span>

            // First we need to verify that the faculty is trying to upload grades for a course offered in the current semester only
<span class="fc" id="L221">            int[] currentSession = facultyDAO.getCurrentAcademicSession();</span>
<span class="fc bfc" id="L222" title="All 4 branches covered.">            if ( year != currentSession[0] || semester != currentSession[1] ) return false;</span>

<span class="fc bfc" id="L224" title="All 2 branches covered.">            if ( !facultyDAO.isCurrentEventGradeSubmission( year, semester ) ) return false;</span>

            // Check if the course has been offered by this particular faculty in the current semester
<span class="fc" id="L227">            boolean isOwnCourse = facultyDAO.checkIfOfferedBySelf( this.id, courseCode, year, semester, offeringDepartment );</span>
<span class="fc bfc" id="L228" title="All 2 branches covered.">            if ( !isOwnCourse ) return false;</span>

<span class="fc" id="L230">            ArrayList&lt;String&gt; arraylistOfEntryNumbers = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L231">            ArrayList&lt;String&gt; arraylistOfGrades       = new ArrayList&lt;&gt;();</span>
            String            courseRecord;

            // Copy the contents of the file into the two lists that were created
<span class="fc bfc" id="L235" title="All 2 branches covered.">            while ( ( courseRecord = gradeCSVFile.readLine() ) != null ) {</span>
<span class="fc" id="L236">                String[] lineContents = courseRecord.split( &quot;,&quot; );</span>
<span class="fc" id="L237">                arraylistOfEntryNumbers.add( lineContents[1] );</span>
<span class="fc" id="L238">                arraylistOfGrades.add( lineContents[2] );</span>
<span class="fc" id="L239">            }</span>
<span class="fc" id="L240">            String[] listOfEntryNumbers = arraylistOfEntryNumbers.toArray( new String[arraylistOfEntryNumbers.size()] );</span>

            // Sorted list of the entry numbers in the CSV file
<span class="fc" id="L243">            Collections.sort( arraylistOfEntryNumbers );</span>

            // Sorted list of the entry numbers in the database
<span class="fc" id="L246">            String[] listOfStudentsInDatabase = facultyDAO.getListOfStudents( courseCode, year, semester, offeringDepartment );</span>
<span class="fc" id="L247">            Arrays.sort( listOfStudentsInDatabase );</span>

            // These two lists must contain the same entry numbers because that was the file generated by the program
<span class="fc bfc" id="L250" title="All 2 branches covered.">            if ( listOfEntryNumbers.length != listOfStudentsInDatabase.length ) return false;</span>
<span class="fc bfc" id="L251" title="All 2 branches covered.">            for ( int i = 0; i &lt; arraylistOfEntryNumbers.size(); i++ ) {</span>
<span class="fc bfc" id="L252" title="All 2 branches covered.">                if ( !arraylistOfEntryNumbers.get( i ).equals( listOfStudentsInDatabase[i] ) ) return false;</span>
            }

            // The course has been verified and the students have been verified. Now we can insert the records into the database
<span class="fc" id="L256">            return facultyDAO.uploadCourseGrades( courseCode, year, semester, offeringDepartment, listOfEntryNumbers, arraylistOfGrades.toArray( new String[arraylistOfGrades.size()] ) );</span>
<span class="fc" id="L257">        } catch ( Exception error ) {</span>
<span class="fc" id="L258">            return false;</span>
        }
    }

    public String[][] getInstructorPrerequisites(String courseCode, int year, int semester, String departmentID) {
<span class="fc bfc" id="L263" title="All 8 branches covered.">        if ( courseCode == null || year &lt; 0 || semester &lt; 0 || departmentID == null ) return new String[][]{};</span>

        // Instructor can only view the prerequisites for his own course
<span class="fc bfc" id="L266" title="All 2 branches covered.">        if ( !facultyDAO.checkIfOfferedBySelf( this.id, courseCode, year, semester, departmentID )) return new String[][]{};</span>

<span class="fc" id="L268">        return facultyDAO.getInstructorPrerequisites( courseCode, year, semester, departmentID );</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>